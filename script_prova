# Make use of english comments, in this manner anyone in the planet could fork and help
#non sapendo che pacchetti avrei utilizzato ho caritcato praticamente tutti quelli che pensavo mi sarebbero stati utili
#lo script è una bozza, sicuramente è da rivedere e da sistemare

# I suggest avoiding this pratice. Make a check on the functions you used and upload related packages

install.packages("ggplot2")
install.packages("patchwork")
install.packages("raster")
install.packages("viridis")
install.packages("devtools")
install_github ("ducciorocchini/imageRy")
install.packages("tidyverse")
install.packages("sf")
install.packages("tidyr")
install.packages("sp")
install.packages("dplyr")
install.packages("gridExtra")
library(gridExtra)
library(devtools)
library(raster)
library(ggplot2)
library(patchwork)
library(viridis)
library(imageRy)
library(tidyverse)
library(sf)
library(tidyr)
library(sp)
library(dplyr)
library(terra)
# creo collegamento con la cartella diretta:
#setwd("C:/Users/Proprietario/Desktop/Telerilevamento")
my_im_list <- list.files("C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero")
my_im_list

#identifichiamo l'area di analisi per quanto riguarda 'area di studio sul Corno Nero; 
#ho ritagliato un area di 95 ettari che comprenda le nostre tre aree (disposte ad altitudini diverse);
AreaRitaglioCornoNero <- st_read("C:/Users/Proprietario/Desktop/fmach/CornoNeroRitaglioq.shp")

#creo i miei vettori dove si salveranno in automatico le percentuali ottenute
percentuali_righe <- list()
riga_corrente <- c()
valori_per_riga <- 10
contatore <- 0

inverno2015_2016 <- 1
inverno2016_2017 <- 1
inverno2017_2018 <- 1
inverno2018_2019 <- 1
inverno2019_2020 <- 1
inverno2020_2021 <- 1
inverno2021_2022 <- 1
inverno2022_2023 <- 1
inverno2023_2024 <- 1

#__________________________analisi neve tramite indice NDSI aree di studio___________________________
#ho iniziato ritagliando l'area di interesse dalla mia immagine satellitare scaricata 
#per le prime prove mi sono assicurata che avesseero le stesse cordinate, che avessero la stessa estensione sia per la banda del visibili che per NDSI, in modo tale che dopo siano confrontabili. 
#mese 09
banda_swir_15.09 <- rast("C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/15.09.15 NDSI.tiff")
Corno_Nero_15.09_CN <- rast("C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/15.09.25 ColoriN_CornoNero.tiff")
df_perc <- c()

# A simple crop function might be used here (?)

st_crs(AreaRitaglioCornoNero)
crs_v <- crs(Corno_Nero_15.09_CN)
crs_s <- crs(banda_swir_15.09)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_15.09_CN <- project(Corno_Nero_15.09_CN, crs_s)
}
crs_v <- crs(Corno_Nero_15.09_CN)
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_15.09_CN <- project(Corno_Nero_15.09_CN, crs_p)
}

banda_swir_15.09_area <- crop(banda_swir_15.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_15.09_area <- crop(Corno_Nero_15.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_15.09 <- CN_CornoNero_15.09_area[[3]]

# this is correct! I suggest avoiding raster + terra and translate all the commands of raster to those of terra
banda_vis_NDSI_15.09 <- terra::resample(banda_vis_NDSI_15.09, banda_swir_15.09_area, 
                                        method = "bilinear" )
res(banda_vis_NDSI_15.09)
res(banda_swir_15.09_area)

ext(AreaRitaglioCornoNero)
ext(banda_vis_NDSI_15.09)
ext(banda_swir_15.09_area)

banda_swir_15.09_area_m <- mask(banda_swir_15.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_15.09_m <- mask(banda_vis_NDSI_15.09, st_as_sf(AreaRitaglioCornoNero))

ext(AreaRitaglioCornoNero)
ext(banda_vis_NDSI_15.09_m)
ext(banda_swir_15.09_area_m)

plot(banda_vis_NDSI_15.09)
plot(banda_swir_15.09_area)
summary(banda_vis_NDSI_15.09)
summary(banda_swir_15.09_area)

print(banda_vis_NDSI_15.09)
print(banda_swir_15.09_area)

class(banda_vis_NDSI_15.09)
class(banda_swir_15.09_area)

#ho creato i due vettori 
Q9 <- banda_vis_NDSI_15.09_m - banda_swir_15.09_area_m
B9 <- banda_vis_NDSI_15.09_m + banda_swir_15.09_area_m

#ho eseguito il calcolo per trovare NDSI
NDSI_CornoNero_15.09_area <- Q9/B9
NDSI_CornoNero_15.09_area

#ho osservato la percentuale di frequenza dell'NDSI
total_cells <- ncell(NDSI_CornoNero_15.09_area)
freq(NDSI_CornoNero_15.09_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_15.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_15.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_15.09)
contatore <- contatore +1
#ho trovato la percentuale ed ho fatto in modo che si salvasse in automatico al'interno di una riga

NDSI_CornoNero_15.09_area_df <- as.data.frame(NDSI_CornoNero_15.09_area, xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_15.09_area_df

#ho provato a plottare l'indice appena trovato
colnames(NDSI_CornoNero_15.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_15.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2015", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()
#ho ripetuto l'operazione per ogni mese per ogni anno dal 2015 al 2024
#mese 10
banda_swir_15.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/15.10.22 NDSI.tiff")
Corno_Nero_15.10_CN <- rast("C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/15.09.25 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_15.10_CN)
crs_s <- crs(banda_swir_15.10)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_15.10_CN <- project(Corno_Nero_15.10_CN, crs_s)
}
crs_v <- crs(Corno_Nero_15.10_CN)
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_15.10_CN <- project(Corno_Nero_15.10_CN, crs_p)
}

banda_swir_15.10_area <- crop(banda_swir_15.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_15.10_area <- crop(Corno_Nero_15.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_15.10 <- CN_CornoNero_15.10_area[[3]]

banda_vis_NDSI_15.10 <- terra::resample(banda_vis_NDSI_15.10, banda_swir_15.10_area, 
                                        method = "bilinear" )
res(banda_vis_NDSI_15.10)
res(banda_swir_15.10_area)

ext(AreaRitaglioCornoNero)
ext(banda_vis_NDSI_15.10)
ext(banda_swir_15.10_area)

banda_swir_15.10_area_m <- mask(banda_swir_15.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_15.10_m <- mask(banda_vis_NDSI_15.10, st_as_sf(AreaRitaglioCornoNero))

ext(banda_vis_NDSI_15.09_m)
ext(banda_swir_15.10_area_m)

plot(banda_vis_NDSI_15.10)
plot(banda_swir_15.10_area)
summary(banda_vis_NDSI_15.10)
summary(banda_swir_15.10_area)

print(banda_vis_NDSI_15.10)
print(banda_swir_15.10_area)

class(banda_vis_NDSI_15.10)
class(banda_swir_15.10_area)


Q10 <- banda_vis_NDSI_15.10_m - banda_swir_15.10_area_m
B10 <- banda_vis_NDSI_15.10_m + banda_swir_15.10_area_m

NDSI_CornoNero_15.10_area <- Q10/B10
NDSI_CornoNero_15.10_area

total_cells <- ncell(NDSI_CornoNero_15.10_area)
freq(NDSI_CornoNero_15.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_15.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_15.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_15.10)
contatore <- contatore +1

NDSI_CornoNero_15.10_area_df <- as.data.frame(NDSI_CornoNero_15.10_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_15.10_area_df
colnames(NDSI_CornoNero_15.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_15.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2015", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 11
banda_swir_15.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/15.11.24 NDSI.tiff")
Corno_Nero_15.11_CN <- rast("C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/15.09.25 ColoriN_CornoNero.tiff")

crs_v <- crs(Corno_Nero_15.11_CN)
crs_s <- crs(banda_swir_15.11)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_15.11_CN <- project(Corno_Nero_15.11_CN, crs_s)
}
crs_v <- crs(Corno_Nero_15.11_CN)
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_15.11_CN <- project(Corno_Nero_15.11_CN, crs_p)
}

banda_swir_15.11_area <- crop(banda_swir_15.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_15.11_area <- crop(Corno_Nero_15.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_15.11 <- CN_CornoNero_15.11_area[[3]]

banda_vis_NDSI_15.11 <- terra::resample(banda_vis_NDSI_15.11, banda_swir_15.11_area, 
                                        method = "bilinear" )

banda_swir_15.11_area_m <- mask(banda_swir_15.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_15.11_m <- mask(banda_vis_NDSI_15.11, st_as_sf(AreaRitaglioCornoNero))

Q11 <- banda_vis_NDSI_15.11_m - banda_swir_15.11_area_m
B11 <- banda_vis_NDSI_15.11_m + banda_swir_15.11_area_m

NDSI_CornoNero_15.11_area <- Q11/B11
NDSI_CornoNero_15.11_area

total_cells <- ncell(NDSI_CornoNero_15.11_area)
freq(NDSI_CornoNero_15.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_15.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_15.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_15.11)
contatore <- contatore +1

NDSI_CornoNero_15.11_area_df <- as.data.frame(NDSI_CornoNero_15.11_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_15.11_area_df
colnames(NDSI_CornoNero_15.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_15.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2015", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 12
banda_swir_15.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/15.12.04 NDSI.tiff")
Corno_Nero_15.12_CN <- rast("C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/15.09.25 ColoriN_CornoNero.tiff")

crs_v <- crs(Corno_Nero_15.12_CN)
crs_s <- crs(banda_swir_15.12)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_15.12_CN <- project(Corno_Nero_15.12_CN, crs_s)
}
crs_v <- crs(Corno_Nero_15.12_CN)
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_15.12_CN <- project(Corno_Nero_15.12_CN, crs_p)
}

banda_swir_15.12_area <- crop(banda_swir_15.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_15.12_area <- crop(Corno_Nero_15.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_15.12 <- CN_CornoNero_15.12_area[[3]]

banda_vis_NDSI_15.12 <- terra::resample(banda_vis_NDSI_15.12, banda_swir_15.12_area, 
                                        method = "bilinear" )
banda_swir_15.12_area_m <- mask(banda_swir_15.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_15.12_m <- mask(banda_vis_NDSI_15.12, st_as_sf(AreaRitaglioCornoNero))

Q12 <- banda_vis_NDSI_15.12_m - banda_swir_15.12_area_m
B12 <- banda_vis_NDSI_15.12_m + banda_swir_15.12_area_m

NDSI_CornoNero_15.12_area <- Q12/B12
NDSI_CornoNero_15.12_area

total_cells <- ncell(NDSI_CornoNero_15.12_area)
freq(NDSI_CornoNero_15.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_15.12_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_15.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_15.12)
contatore <- contatore +1

NDSI_CornoNero_15.12_area_df <- as.data.frame(NDSI_CornoNero_15.12_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_15.12_area_df
colnames(NDSI_CornoNero_15.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_15.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2015", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 16.01
banda_swir_16.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.01.03 NDSI.tiff")
Corno_Nero_16.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.01_CN)
crs_s <- crs(banda_swir_16.01)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_16.01_CN <- project(Corno_Nero_16.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.01_CN <- project(Corno_Nero_16.01_CN, crs_p)
}
banda_swir_16.01_area <- crop(banda_swir_16.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.01_area <- crop(Corno_Nero_16.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.01 <- CN_CornoNero_16.01_area[[3]]
banda_vis_NDSI_16.01 <- terra::resample(banda_vis_NDSI_16.01, banda_swir_16.01_area, 
                                        method = "bilinear" )
banda_swir_16.01_area_m <- mask(banda_swir_16.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.01_m <- mask(banda_vis_NDSI_16.01, st_as_sf(AreaRitaglioCornoNero))

Q01 <- banda_vis_NDSI_16.01_m - banda_swir_16.01_area_m
B01 <- banda_vis_NDSI_16.01_m + banda_swir_16.01_area_m
NDSI_CornoNero_16.01_area <- Q01/B01
NDSI_CornoNero_16.01_area

total_cells <- ncell(NDSI_CornoNero_16.01_area)
freq(NDSI_CornoNero_16.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.01)
contatore <- contatore +1

NDSI_CornoNero_16.01_area_df <- as.data.frame(NDSI_CornoNero_16.01_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.01_area_df
colnames(NDSI_CornoNero_16.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 16.02
banda_swir_16.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.02.12 NDSI.tiff")
Corno_Nero_16.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.02_CN)
crs_s <- crs(banda_swir_16.02)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_16.02_CN <- project(Corno_Nero_16.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.02_CN <- project(Corno_Nero_16.02_CN, crs_p)
}
banda_swir_16.02_area <- crop(banda_swir_16.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.02_area <- crop(Corno_Nero_16.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.02 <- CN_CornoNero_16.02_area[[3]]
banda_vis_NDSI_16.02 <- terra::resample(banda_vis_NDSI_16.02, banda_swir_16.02_area, 
                                        method = "bilinear" )
banda_swir_16.02_area_m <- mask(banda_swir_16.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.02_m <- mask(banda_vis_NDSI_16.02, st_as_sf(AreaRitaglioCornoNero))

Q02 <- banda_vis_NDSI_16.02_m - banda_swir_16.02_area_m
B02 <- banda_vis_NDSI_16.02_m + banda_swir_16.02_area_m
NDSI_CornoNero_16.02_area <- Q02/B02
NDSI_CornoNero_16.02_area

total_cells <- ncell(NDSI_CornoNero_16.02_area)
freq(NDSI_CornoNero_16.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.02)
contatore <- contatore +1

NDSI_CornoNero_16.02_area_df <- as.data.frame(NDSI_CornoNero_16.02_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.02_area_df
colnames(NDSI_CornoNero_16.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 16.03
banda_swir_16.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.03.23 NDSI.tiff")
Corno_Nero_16.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.03_CN)
crs_s <- crs(banda_swir_16.03)
crs_v
crs_s

if(!identical(crs_v, crs_s)){
  Corno_Nero_16.03_CN <- project(Corno_Nero_16.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.03_CN <- project(Corno_Nero_16.03_CN, crs_p)
}
banda_swir_16.03_area <- crop(banda_swir_16.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.03_area <- crop(Corno_Nero_16.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.03 <- CN_CornoNero_16.03_area[[3]]
banda_vis_NDSI_16.03 <- terra::resample(banda_vis_NDSI_16.03, banda_swir_16.03_area, 
                                        method = "bilinear" )
banda_swir_16.03_area_m <- mask(banda_swir_16.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.03_m <- mask(banda_vis_NDSI_16.03, st_as_sf(AreaRitaglioCornoNero))

Q03 <- banda_vis_NDSI_16.03_m - banda_swir_16.03_area_m
B03 <- banda_vis_NDSI_16.03_m + banda_swir_16.03_area_m
NDSI_CornoNero_16.03_area <- Q03/B03
NDSI_CornoNero_16.03_area

total_cells <- ncell(NDSI_CornoNero_16.03_area)
freq(NDSI_CornoNero_16.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.03_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.03)
contatore <- contatore +1
NDSI_CornoNero_16.03_area_df <- as.data.frame(NDSI_CornoNero_16.03_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.03_area_df
colnames(NDSI_CornoNero_16.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 16.04
banda_swir_16.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.04.19 NDSI.tiff")
Corno_Nero_16.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.04_CN)
crs_s <- crs(banda_swir_16.04)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_16.04_CN <- project(Corno_Nero_16.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.04_CN <- project(Corno_Nero_16.04_CN, crs_p)
}
banda_swir_16.04_area <- crop(banda_swir_16.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.04_area <- crop(Corno_Nero_16.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.04 <- CN_CornoNero_16.04_area[[3]]
banda_vis_NDSI_16.04 <- terra::resample(banda_vis_NDSI_16.04, banda_swir_16.04_area, 
                                        method = "bilinear" )
banda_swir_16.04_area_m <- mask(banda_swir_16.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.04_m <- mask(banda_vis_NDSI_16.04, st_as_sf(AreaRitaglioCornoNero))

Q04 <- banda_vis_NDSI_16.04_m - banda_swir_16.04_area_m
B04 <- banda_vis_NDSI_16.04_m + banda_swir_16.04_area_m
NDSI_CornoNero_16.04_area <- Q04/B04
NDSI_CornoNero_16.04_area

total_cells <- ncell(NDSI_CornoNero_16.04_area)
freq(NDSI_CornoNero_16.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.04_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.04)
contatore <- contatore +1

NDSI_CornoNero_16.04_area_df <- as.data.frame(NDSI_CornoNero_16.04_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.04_area_df
colnames(NDSI_CornoNero_16.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 16.05
banda_swir_16.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.05.22 NDSI.tiff")
Corno_Nero_16.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.05_CN)
crs_s <- crs(banda_swir_16.05)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_16.05_CN <- project(Corno_Nero_16.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.05_CN <- project(Corno_Nero_16.05_CN, crs_p)
}
banda_swir_16.05_area <- crop(banda_swir_16.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.05_area <- crop(Corno_Nero_16.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.05 <- CN_CornoNero_16.05_area[[3]]
banda_vis_NDSI_16.05 <- terra::resample(banda_vis_NDSI_16.05, banda_swir_16.05_area, 
                                        method = "bilinear" )
banda_swir_16.05_area_m <- mask(banda_swir_16.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.05_m <- mask(banda_vis_NDSI_16.05, st_as_sf(AreaRitaglioCornoNero))

Q05 <- banda_vis_NDSI_16.05_m - banda_swir_16.05_area_m
B05 <- banda_vis_NDSI_16.05_m + banda_swir_16.05_area_m
NDSI_CornoNero_16.05_area <- Q05/B05
NDSI_CornoNero_16.05_area

total_cells <- ncell(NDSI_CornoNero_16.05_area)
freq(NDSI_CornoNero_16.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.05_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.05)
contatore <- contatore +1

NDSI_CornoNero_16.05_area_df <- as.data.frame(NDSI_CornoNero_16.05_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.05_area_df
colnames(NDSI_CornoNero_16.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()
#mese 16.06
banda_swir_16.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.06.28 NDSI.tiff")
Corno_Nero_16.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.06_CN)
crs_s <- crs(banda_swir_16.06)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_16.06_CN <- project(Corno_Nero_16.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.06_CN <- project(Corno_Nero_16.06_CN, crs_p)
}
banda_swir_16.06_area <- crop(banda_swir_16.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.06_area <- crop(Corno_Nero_16.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.06 <- CN_CornoNero_16.06_area[[3]]
banda_vis_NDSI_16.06 <- terra::resample(banda_vis_NDSI_16.06, banda_swir_16.06_area, 
                                        method = "bilinear" )
banda_swir_16.06_area_m <- mask(banda_swir_16.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.06_m <- mask(banda_vis_NDSI_16.06, st_as_sf(AreaRitaglioCornoNero))

Q06 <- banda_vis_NDSI_16.06_m - banda_swir_16.06_area_m
B06 <- banda_vis_NDSI_16.06_m + banda_swir_16.06_area_m
NDSI_CornoNero_16.06_area <- Q06/B06
NDSI_CornoNero_16.06_area

total_cells <- ncell(NDSI_CornoNero_16.06_area)
freq(NDSI_CornoNero_16.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.06_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.06)
contatore <- contatore +1

NDSI_CornoNero_16.06_area_df <- as.data.frame(NDSI_CornoNero_16.06_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.06_area_df
colnames(NDSI_CornoNero_16.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2015_2016)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2015_2016 <- inverno2015_2016 +1
}

percentuali_righe

#----- FINE PRIMO ANNO ------

#mese 16.09
banda_swir_16.09 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.09.06 NDSI.tiff")
Corno_Nero_16.09_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.09_CN)
crs_s <- crs(banda_swir_16.09)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_16.09_CN <- project(Corno_Nero_16.09_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.09_CN <- project(Corno_Nero_16.09_CN, crs_p)
}
banda_swir_16.09_area <- crop(banda_swir_16.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.09_area <- crop(Corno_Nero_16.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.09 <- CN_CornoNero_16.09_area[[3]]
banda_vis_NDSI_16.09 <- terra::resample(banda_vis_NDSI_16.09, banda_swir_16.09_area, 
                                        method = "bilinear" )
banda_swir_16.09_area_m <- mask(banda_swir_16.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.09_m <- mask(banda_vis_NDSI_16.09, st_as_sf(AreaRitaglioCornoNero))

Q09 <- banda_vis_NDSI_16.09_m - banda_swir_16.09_area_m
B09 <- banda_vis_NDSI_16.09_m + banda_swir_16.09_area_m
NDSI_CornoNero_16.09_area <- Q09/B09
NDSI_CornoNero_16.09_area

total_cells <- ncell(NDSI_CornoNero_16.09_area)
freq(NDSI_CornoNero_16.09_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.09)
contatore <- contatore +1


NDSI_CornoNero_16.09_area_df <- as.data.frame(NDSI_CornoNero_16.09_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.09_area_df
colnames(NDSI_CornoNero_16.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 16.10
banda_swir_16.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.10.16 NDSI.tiff")
Corno_Nero_16.10_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.10_CN)
crs_s <- crs(banda_swir_16.10)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_16.10_CN <- project(Corno_Nero_16.10_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.10_CN <- project(Corno_Nero_16.10_CN, crs_p)
}
banda_swir_16.10_area <- crop(banda_swir_16.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.10_area <- crop(Corno_Nero_16.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.10 <- CN_CornoNero_16.10_area[[3]]
banda_vis_NDSI_16.10 <- terra::resample(banda_vis_NDSI_16.10, banda_swir_16.10_area, 
                                        method = "bilinear" )
banda_swir_16.10_area_m <- mask(banda_swir_16.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.10_m <- mask(banda_vis_NDSI_16.10, st_as_sf(AreaRitaglioCornoNero))

Q10 <- banda_vis_NDSI_16.10_m - banda_swir_16.10_area_m
B10 <- banda_vis_NDSI_16.10_m + banda_swir_16.10_area_m
NDSI_CornoNero_16.10_area <- Q10/B10
NDSI_CornoNero_16.10_area

total_cells <- ncell(NDSI_CornoNero_16.10_area)
freq(NDSI_CornoNero_16.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.10)
contatore <- contatore +1

NDSI_CornoNero_16.10_area_df <- as.data.frame(NDSI_CornoNero_16.10_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.10_area_df
colnames(NDSI_CornoNero_16.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 16.11
banda_swir_16.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.11.28_NDSI.tiff")
Corno_Nero_16.11_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.11_CN)
crs_s <- crs(banda_swir_16.11)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_16.11_CN <- project(Corno_Nero_16.11_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.11_CN <- project(Corno_Nero_16.11_CN, crs_p)
}
banda_swir_16.11_area <- crop(banda_swir_16.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.11_area <- crop(Corno_Nero_16.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.11 <- CN_CornoNero_16.11_area[[3]]
banda_vis_NDSI_16.11 <- terra::resample(banda_vis_NDSI_16.11, banda_swir_16.11_area, 
                                        method = "bilinear" )
banda_swir_16.11_area_m <- mask(banda_swir_16.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.11_m <- mask(banda_vis_NDSI_16.11, st_as_sf(AreaRitaglioCornoNero))

Q11 <- banda_vis_NDSI_16.11_m - banda_swir_16.11_area_m
B11 <- banda_vis_NDSI_16.11_m + banda_swir_16.11_area_m
NDSI_CornoNero_16.11_area <- Q11/B11
NDSI_CornoNero_16.11_area

total_cells <- ncell(NDSI_CornoNero_16.11_area)
freq(NDSI_CornoNero_16.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.11)
contatore <- contatore +1

NDSI_CornoNero_16.11_area_df <- as.data.frame(NDSI_CornoNero_16.11_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.11_area_df
colnames(NDSI_CornoNero_16.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 16.12
banda_swir_16.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/16.12.28_NDSI.tiff")
Corno_Nero_16.12_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/16.08.17 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_16.12_CN)
crs_s <- crs(banda_swir_16.12)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_16.12_CN <- project(Corno_Nero_16.12_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_16.12_CN <- project(Corno_Nero_16.12_CN, crs_p)
}
banda_swir_16.12_area <- crop(banda_swir_16.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_16.12_area <- crop(Corno_Nero_16.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.12 <- CN_CornoNero_16.12_area[[3]]
banda_vis_NDSI_16.12 <- terra::resample(banda_vis_NDSI_16.12, banda_swir_16.12_area, 
                                        method = "bilinear" )
res(banda_vis_NDSI_16.12) #risoluzione
res(banda_swir_16.12_area)
ext(banda_vis_NDSI_16.12)
ext(banda_swir_16.12_area)
banda_swir_16.12_area_m <- mask(banda_swir_16.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_16.12_m <- mask(banda_vis_NDSI_16.12, st_as_sf(AreaRitaglioCornoNero))

Q12 <- banda_vis_NDSI_16.12_m - banda_swir_16.12_area_m
B12 <- banda_vis_NDSI_16.12_m + banda_swir_16.12_area_m
NDSI_CornoNero_16.12_area <- Q12/B12
NDSI_CornoNero_16.12_area

total_cells <- ncell(NDSI_CornoNero_16.12_area)
freq(NDSI_CornoNero_16.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_16.12_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_16.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_16.12)
contatore <- contatore +1

NDSI_CornoNero_16.12_area_df <- as.data.frame(NDSI_CornoNero_16.12_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_16.12_area_df
colnames(NDSI_CornoNero_16.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_16.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 17.01
banda_swir_17.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.01.27_NDSI.tiff")
Corno_Nero_17.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.01_CN)
crs_s <- crs(banda_swir_17.01)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.01_CN <- project(Corno_Nero_17.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.01_CN <- project(Corno_Nero_17.01_CN, crs_p)
}
banda_swir_17.01_area <- crop(banda_swir_17.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.01_area <- crop(Corno_Nero_17.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.01 <- CN_CornoNero_17.01_area[[3]]
banda_vis_NDSI_17.01 <- terra::resample(banda_vis_NDSI_17.01, banda_swir_17.01_area, 
                                        method = "bilinear" )
banda_swir_17.01_area_m <- mask(banda_swir_17.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.01_m <- mask(banda_vis_NDSI_17.01, st_as_sf(AreaRitaglioCornoNero))

Q01_17 <- banda_vis_NDSI_17.01_m - banda_swir_17.01_area_m
B01_17 <- banda_vis_NDSI_17.01_m + banda_swir_17.01_area_m
NDSI_CornoNero_17.01_area <- Q01_17/B01_17
NDSI_CornoNero_17.01_area

total_cells <- ncell(NDSI_CornoNero_17.01_area)
freq(NDSI_CornoNero_17.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_17.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.01)
contatore <- contatore +1

NDSI_CornoNero_17.01_area_df <- as.data.frame(NDSI_CornoNero_17.01_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.01_area_df
colnames(NDSI_CornoNero_17.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2016", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()


#mese 17.02
banda_swir_17.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.02.13_NDSI.tiff")
Corno_Nero_17.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.02_CN)
crs_s <- crs(banda_swir_17.02)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.02_CN <- project(Corno_Nero_17.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.02_CN <- project(Corno_Nero_17.02_CN, crs_p)
}
banda_swir_17.02_area <- crop(banda_swir_17.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.02_area <- crop(Corno_Nero_17.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.02 <- CN_CornoNero_17.02_area[[3]]
banda_vis_NDSI_17.02 <- terra::resample(banda_vis_NDSI_17.02, banda_swir_17.02_area, 
                                        method = "bilinear" )
banda_swir_17.02_area_m <- mask(banda_swir_17.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.02_m <- mask(banda_vis_NDSI_17.02, st_as_sf(AreaRitaglioCornoNero))

Q02_17 <- banda_vis_NDSI_17.02_m - banda_swir_17.02_area_m
B02_17 <- banda_vis_NDSI_17.02_m + banda_swir_17.02_area_m
NDSI_CornoNero_17.02_area <- Q02_17/B02_17
NDSI_CornoNero_17.02_area

#sopra valore 0.4 indica neve
#sotto 0 neve assente
total_cells <- ncell(NDSI_CornoNero_17.02_area)
freq(NDSI_CornoNero_17.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_17.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.02)
contatore <- contatore +1

NDSI_CornoNero_17.02_area_df <- as.data.frame(NDSI_CornoNero_17.02_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.02_area_df
colnames(NDSI_CornoNero_17.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2017", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 17.03
banda_swir_17.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.03.17_NDSI.tiff")
Corno_Nero_17.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.03_CN)
crs_s <- crs(banda_swir_17.03)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.03_CN <- project(Corno_Nero_17.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.03_CN <- project(Corno_Nero_17.03_CN, crs_p)
}
banda_swir_17.03_area <- crop(banda_swir_17.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.03_area <- crop(Corno_Nero_17.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.03 <- CN_CornoNero_17.03_area[[3]]
banda_vis_NDSI_17.03 <- terra::resample(banda_vis_NDSI_17.03, banda_swir_17.03_area, 
                                        method = "bilinear" )
banda_swir_17.03_area_m <- mask(banda_swir_17.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.03_m <- mask(banda_vis_NDSI_17.03, st_as_sf(AreaRitaglioCornoNero))

Q03_17 <- banda_vis_NDSI_17.03_m - banda_swir_17.03_area_m
B03_17 <- banda_vis_NDSI_17.03_m + banda_swir_17.03_area_m
NDSI_CornoNero_17.03_area <- Q03_17/B03_17
NDSI_CornoNero_17.03_area

total_cells <- ncell(NDSI_CornoNero_17.03_area)
freq(NDSI_CornoNero_17.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.03_area > 0.4, value = TRUE)[1, "count"]
percentage_snow_17.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.03)
contatore <- contatore +1

NDSI_CornoNero_17.03_area_df <- as.data.frame(NDSI_CornoNero_17.03_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.03_area_df
colnames(NDSI_CornoNero_17.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2017", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 17.04
banda_swir_17.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.04.12_NDSI.tiff")
Corno_Nero_17.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.04_CN)
crs_s <- crs(banda_swir_17.04)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.04_CN <- project(Corno_Nero_17.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.04_CN <- project(Corno_Nero_17.04_CN, crs_p)
}
banda_swir_17.04_area <- crop(banda_swir_17.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.04_area <- crop(Corno_Nero_17.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.04 <- CN_CornoNero_17.04_area[[3]]
banda_vis_NDSI_17.04 <- terra::resample(banda_vis_NDSI_17.04, banda_swir_17.04_area, 
                                        method = "bilinear" )
banda_swir_17.04_area_m <- mask(banda_swir_17.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.04_m <- mask(banda_vis_NDSI_17.04, st_as_sf(AreaRitaglioCornoNero))

Q04_17 <- banda_vis_NDSI_17.04_m - banda_swir_17.04_area_m
B04_17 <- banda_vis_NDSI_17.04_m + banda_swir_17.04_area_m
NDSI_CornoNero_17.04_area <- Q04_17/B04_17
NDSI_CornoNero_17.04_area

total_cells <- ncell(NDSI_CornoNero_17.04_area)
freq(NDSI_CornoNero_17.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.04_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_17.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.04)
contatore <- contatore +1

NDSI_CornoNero_17.04_area_df <- as.data.frame(NDSI_CornoNero_17.04_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.04_area_df
colnames(NDSI_CornoNero_17.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2017", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()
#mese 17.05
banda_swir_17.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.05.27_NDSI.tiff")
Corno_Nero_17.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.05_CN)
crs_s <- crs(banda_swir_17.05)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.05_CN <- project(Corno_Nero_17.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.05_CN <- project(Corno_Nero_17.05_CN, crs_p)
}
banda_swir_17.05_area <- crop(banda_swir_17.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.05_area <- crop(Corno_Nero_17.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.05 <- CN_CornoNero_17.05_area[[3]]
banda_vis_NDSI_17.05 <- terra::resample(banda_vis_NDSI_17.05, banda_swir_17.05_area, 
                                        method = "bilinear" )
banda_swir_17.05_area_m <- mask(banda_swir_17.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.05_m <- mask(banda_vis_NDSI_17.05, st_as_sf(AreaRitaglioCornoNero))

Q05_17 <- banda_vis_NDSI_17.05_m - banda_swir_17.05_area_m
B05_17 <- banda_vis_NDSI_17.05_m + banda_swir_17.05_area_m
NDSI_CornoNero_17.05_area <- Q05_17/B05_17
NDSI_CornoNero_17.05_area

total_cells <- ncell(NDSI_CornoNero_17.05_area)
total_cells
freq(NDSI_CornoNero_17.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.05_area > 0.5, value = TRUE)[1, "count"]
cells_with_snow
percentage_snow_17.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.05)
contatore <- contatore +1

NDSI_CornoNero_17.05_area_df <- as.data.frame(NDSI_CornoNero_17.05_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.05_area_df
colnames(NDSI_CornoNero_17.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2017", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 17.06
banda_swir_17.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.06.11_NDSI.tiff")
Corno_Nero_17.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.06_CN)
crs_s <- crs(banda_swir_17.06)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.06_CN <- project(Corno_Nero_17.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.06_CN <- project(Corno_Nero_17.06_CN, crs_p)
}
banda_swir_17.06_area <- crop(banda_swir_17.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.06_area <- crop(Corno_Nero_17.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.06 <- CN_CornoNero_17.06_area[[3]]
banda_vis_NDSI_17.06 <- terra::resample(banda_vis_NDSI_17.06, banda_swir_17.06_area, 
                                        method = "bilinear" )
banda_swir_17.06_area_m <- mask(banda_swir_17.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.06_m <- mask(banda_vis_NDSI_17.06, st_as_sf(AreaRitaglioCornoNero))

Q06_17 <- banda_vis_NDSI_17.06_m - banda_swir_17.06_area_m
B06_17 <- banda_vis_NDSI_17.06_m + banda_swir_17.06_area_m
NDSI_CornoNero_17.06_area <- Q06_17/B06_17
NDSI_CornoNero_17.06_area

total_cells <- ncell(NDSI_CornoNero_17.06_area)
total_cells
freq(NDSI_CornoNero_17.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.06_area > 0.4, value = TRUE)[1, "count"]
cells_with_snow
percentage_snow_17.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.06)
contatore <- contatore +1

NDSI_CornoNero_17.06_area_df <- as.data.frame(NDSI_CornoNero_17.06_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.06_area_df
colnames(NDSI_CornoNero_17.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2017", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2016_2017)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2016_2017 <- inverno2016_2017 +1
}

percentuali_righe

#----- FINE SECONDO ANNO ------


#mese 17.09
banda_swir_17.09 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.09.21_NDSI.tiff")
Corno_Nero_17.09_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.09_CN)
crs_s <- crs(banda_swir_17.09)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.09_CN <- project(Corno_Nero_17.09_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.09_CN <- project(Corno_Nero_17.09_CN, crs_p)
}
banda_swir_17.09_area <- crop(banda_swir_17.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.09_area <- crop(Corno_Nero_17.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.09 <- CN_CornoNero_17.09_area[[3]]
banda_vis_NDSI_17.09 <- terra::resample(banda_vis_NDSI_17.09, banda_swir_17.09_area, 
                                        method = "bilinear" )
banda_swir_17.09_area_m <- mask(banda_swir_17.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.09_m <- mask(banda_vis_NDSI_17.09, st_as_sf(AreaRitaglioCornoNero))

Q09_17 <- banda_vis_NDSI_17.09_m - banda_swir_17.09_area_m
B09_17 <- banda_vis_NDSI_17.09_m + banda_swir_17.09_area_m
NDSI_CornoNero_17.09_area <- Q09_17/B09_17
NDSI_CornoNero_17.09_area

total_cells <- ncell(NDSI_CornoNero_17.09_area)
freq(NDSI_CornoNero_17.09_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_17.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.09)
contatore <- contatore +1

NDSI_CornoNero_17.09_area_df <- as.data.frame(NDSI_CornoNero_17.09_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.09_area_df
colnames(NDSI_CornoNero_17.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2017", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 17.10
banda_swir_17.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.10.16 NDSI.tiff")
Corno_Nero_17.10_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.10_CN)
crs_s <- crs(banda_swir_17.10)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.10_CN <- project(Corno_Nero_17.10_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.10_CN <- project(Corno_Nero_17.10_CN, crs_p)
}
banda_swir_17.10_area <- crop(banda_swir_17.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.10_area <- crop(Corno_Nero_17.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.10 <- CN_CornoNero_17.10_area[[3]]
banda_vis_NDSI_17.10 <- terra::resample(banda_vis_NDSI_17.10, banda_swir_17.10_area, 
                                        method = "bilinear" )
banda_swir_17.10_area_m <- mask(banda_swir_17.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.10_m <- mask(banda_vis_NDSI_17.10, st_as_sf(AreaRitaglioCornoNero))

Q10_17 <- banda_vis_NDSI_17.10_m - banda_swir_17.10_area_m
B10_17 <- banda_vis_NDSI_17.10_m + banda_swir_17.10_area_m
NDSI_CornoNero_17.10_area <- Q10_17/B10_17
NDSI_CornoNero_17.10_area

total_cells <- ncell(NDSI_CornoNero_17.10_area)
freq(NDSI_CornoNero_17.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_17.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.10)
contatore <- contatore +1

NDSI_CornoNero_17.10_area_df <- as.data.frame(NDSI_CornoNero_17.10_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.10_area_df
colnames(NDSI_CornoNero_17.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2017", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 17.11
banda_swir_17.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.11.15_NDSI.tiff")
Corno_Nero_17.11_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.11_CN)
crs_s <- crs(banda_swir_17.11)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.11_CN <- project(Corno_Nero_17.11_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.11_CN <- project(Corno_Nero_17.11_CN, crs_p)
}
banda_swir_17.11_area <- crop(banda_swir_17.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.11_area <- crop(Corno_Nero_17.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.11 <- CN_CornoNero_17.11_area[[3]]
banda_vis_NDSI_17.11 <- terra::resample(banda_vis_NDSI_17.11, banda_swir_17.11_area, 
                                        method = "bilinear" )
banda_swir_17.11_area_m <- mask(banda_swir_17.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.11_m <- mask(banda_vis_NDSI_17.11, st_as_sf(AreaRitaglioCornoNero))

Q11_17 <- banda_vis_NDSI_17.11_m - banda_swir_17.11_area_m
B11_17 <- banda_vis_NDSI_17.11_m + banda_swir_17.11_area_m
NDSI_CornoNero_17.11_area <- Q11_17/B11_17
NDSI_CornoNero_17.11_area

total_cells <- ncell(NDSI_CornoNero_17.11_area)
freq(NDSI_CornoNero_17.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_17.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.11)
contatore <- contatore +1

NDSI_CornoNero_17.11_area_df <- as.data.frame(NDSI_CornoNero_17.11_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.11_area_df
colnames(NDSI_CornoNero_17.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2017", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 17.12
banda_swir_17.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/17.12.20_NDSI.tiff")
Corno_Nero_17.12_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/17.07.16 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_17.12_CN)
crs_s <- crs(banda_swir_17.12)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_17.12_CN <- project(Corno_Nero_17.12_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_17.12_CN <- project(Corno_Nero_17.12_CN, crs_p)
}
banda_swir_17.12_area <- crop(banda_swir_17.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_17.12_area <- crop(Corno_Nero_17.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.12 <- CN_CornoNero_17.12_area[[3]]
banda_vis_NDSI_17.12 <- terra::resample(banda_vis_NDSI_17.12, banda_swir_17.12_area, 
                                        method = "bilinear" )
banda_swir_17.12_area_m <- mask(banda_swir_17.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_17.12_m <- mask(banda_vis_NDSI_17.12, st_as_sf(AreaRitaglioCornoNero))

Q12_17 <- banda_vis_NDSI_17.12_m - banda_swir_17.12_area_m
B12_17 <- banda_vis_NDSI_17.12_m + banda_swir_17.12_area_m
NDSI_CornoNero_17.12_area <- Q12_17/B12_17
NDSI_CornoNero_17.12_area

total_cells <- ncell(NDSI_CornoNero_17.12_area)
total_cells
freq(NDSI_CornoNero_17.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_17.12_area > 0.4, value = TRUE)[1, "count"]
cells_with_snow
percentage_snow_17.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_17.12)
contatore <- contatore +1
NDSI_CornoNero_17.12_area_df <- as.data.frame(NDSI_CornoNero_17.12_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_17.12_area_df
colnames(NDSI_CornoNero_17.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_17.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2017", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 18.01
banda_swir_18.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.01.30_NDSI.tiff")
Corno_Nero_18.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.01_CN)
crs_s <- crs(banda_swir_18.01)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.01_CN <- project(Corno_Nero_18.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.01_CN <- project(Corno_Nero_18.01_CN, crs_p)
}
banda_swir_18.01_area <- crop(banda_swir_18.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.01_area <- crop(Corno_Nero_18.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.01 <- CN_CornoNero_18.01_area[[3]]
banda_vis_NDSI_18.01 <- terra::resample(banda_vis_NDSI_18.01, banda_swir_18.01_area, 
                                        method = "bilinear" )
banda_swir_18.01_area_m <- mask(banda_swir_18.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.01_m <- mask(banda_vis_NDSI_18.01, st_as_sf(AreaRitaglioCornoNero))

Q01_18 <- banda_vis_NDSI_18.01_m - banda_swir_18.01_area_m
B01_18 <- banda_vis_NDSI_18.01_m + banda_swir_18.01_area_m
NDSI_CornoNero_18.01_area <- Q01_18/B01_18
NDSI_CornoNero_18.01_area

total_cells <- ncell(NDSI_CornoNero_18.01_area)
freq(NDSI_CornoNero_18.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_18.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.01)
contatore <- contatore +1
NDSI_CornoNero_18.01_area_df <- as.data.frame(NDSI_CornoNero_18.01_area, 
                                              xy = TRUE, na.rm = TRUE)
NDSI_CornoNero_18.01_area_df
colnames(NDSI_CornoNero_18.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 18.02
banda_swir_18.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.02.08_NDSI.tiff")
Corno_Nero_18.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.02_CN)
crs_s <- crs(banda_swir_18.02)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.02_CN <- project(Corno_Nero_18.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.02_CN <- project(Corno_Nero_18.02_CN, crs_p)
}
banda_swir_18.02_area <- crop(banda_swir_18.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.02_area <- crop(Corno_Nero_18.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.02 <- CN_CornoNero_18.02_area[[3]]
banda_vis_NDSI_18.02 <- terra::resample(banda_vis_NDSI_18.02, banda_swir_18.02_area, 
                                        method = "bilinear" )
banda_swir_18.02_area_m <- mask(banda_swir_18.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.02_m <- mask(banda_vis_NDSI_18.02, st_as_sf(AreaRitaglioCornoNero))

Q02_18 <- banda_vis_NDSI_18.02_m - banda_swir_18.02_area_m
B02_18 <- banda_vis_NDSI_18.02_m + banda_swir_18.02_area_m
NDSI_CornoNero_18.02_area <- Q02_18/B02_18

total_cells <- ncell(NDSI_CornoNero_18.02_area)
freq(NDSI_CornoNero_18.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_18.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.02)
contatore <- contatore +1

NDSI_CornoNero_18.02_area_df <- as.data.frame(NDSI_CornoNero_18.02_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_18.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 18.03
banda_swir_18.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.03.23_NDSI.tiff")
Corno_Nero_18.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.03_CN)
crs_s <- crs(banda_swir_18.03)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.03_CN <- project(Corno_Nero_18.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.03_CN <- project(Corno_Nero_18.03_CN, crs_p)
}
banda_swir_18.03_area <- crop(banda_swir_18.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.03_area <- crop(Corno_Nero_18.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.03 <- CN_CornoNero_18.03_area[[3]]
banda_vis_NDSI_18.03 <- terra::resample(banda_vis_NDSI_18.03, banda_swir_18.03_area, 
                                        method = "bilinear" )
banda_swir_18.03_area_m <- mask(banda_swir_18.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.03_m <- mask(banda_vis_NDSI_18.03, st_as_sf(AreaRitaglioCornoNero))

Q03_18 <- banda_vis_NDSI_18.03_m - banda_swir_18.03_area_m
B03_18 <- banda_vis_NDSI_18.03_m + banda_swir_18.03_area_m
NDSI_CornoNero_18.03_area <- Q03_18/B03_18

total_cells <- ncell(NDSI_CornoNero_18.03_area)
freq(NDSI_CornoNero_18.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.03_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_18.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.03)
contatore <- contatore +1
NDSI_CornoNero_18.03_area_df <- as.data.frame(NDSI_CornoNero_18.03_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_18.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 18.04
banda_swir_18.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.04.19_NDSI.tiff")
Corno_Nero_18.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.04_CN)
crs_s <- crs(banda_swir_18.04)
crs_v
crs_s
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.04_CN <- project(Corno_Nero_18.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.04_CN <- project(Corno_Nero_18.04_CN, crs_p)
}
banda_swir_18.04_area <- crop(banda_swir_18.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.04_area <- crop(Corno_Nero_18.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.04 <- CN_CornoNero_18.04_area[[3]]
banda_vis_NDSI_18.04 <- terra::resample(banda_vis_NDSI_18.04, banda_swir_18.04_area, 
                                        method = "bilinear" )
banda_swir_18.04_area_m <- mask(banda_swir_18.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.04_m <- mask(banda_vis_NDSI_18.04, st_as_sf(AreaRitaglioCornoNero))

Q04_18 <- banda_vis_NDSI_18.04_m - banda_swir_18.04_area_m
B04_18 <- banda_vis_NDSI_18.04_m + banda_swir_18.04_area_m
NDSI_CornoNero_18.04_area <- Q04_18/B04_18

total_cells <- ncell(NDSI_CornoNero_18.04_area)
total_cells
freq(NDSI_CornoNero_18.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.04_area > 0.5, value = TRUE)[1, "count"]
cells_with_snow
percentage_snow_18.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.04)
contatore <- contatore +1

NDSI_CornoNero_18.04_area_df <- as.data.frame(NDSI_CornoNero_18.04_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_18.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 18.05
banda_swir_18.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.05.26 NDSI.tiff")
Corno_Nero_18.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.05_CN)
crs_s <- crs(banda_swir_18.05)
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.05_CN <- project(Corno_Nero_18.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.05_CN <- project(Corno_Nero_18.05_CN, crs_p)
}
banda_swir_18.05_area <- crop(banda_swir_18.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.05_area <- crop(Corno_Nero_18.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.05 <- CN_CornoNero_18.05_area[[3]]
banda_vis_NDSI_18.05 <- terra::resample(banda_vis_NDSI_18.05, banda_swir_18.05_area, 
                                        method = "bilinear" )
banda_swir_18.05_area_m <- mask(banda_swir_18.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.05_m <- mask(banda_vis_NDSI_18.05, st_as_sf(AreaRitaglioCornoNero))

Q05_18 <- banda_vis_NDSI_18.05_m - banda_swir_18.05_area_m
B05_18 <- banda_vis_NDSI_18.05_m + banda_swir_18.05_area_m
NDSI_CornoNero_18.05_area <- Q05_18/B05_18

total_cells <- ncell(NDSI_CornoNero_18.05_area)
total_cells
freq(NDSI_CornoNero_18.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.05_area > 0.5, value = TRUE)[1, "count"]
cells_with_snow
percentage_snow_18.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.05)
contatore <- contatore +1

NDSI_CornoNero_18.05_area_df <- as.data.frame(NDSI_CornoNero_18.05_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_18.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 18.06
banda_swir_18.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.06.26 NDSI.tiff")
Corno_Nero_18.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.06_CN)
crs_s <- crs(banda_swir_18.06)
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.06_CN <- project(Corno_Nero_18.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.06_CN <- project(Corno_Nero_18.06_CN, crs_p)
}
banda_swir_18.06_area <- crop(banda_swir_18.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.06_area <- crop(Corno_Nero_18.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.06 <- CN_CornoNero_18.06_area[[3]]
banda_vis_NDSI_18.06 <- terra::resample(banda_vis_NDSI_18.06, banda_swir_18.06_area, 
                                        method = "bilinear" )
banda_swir_18.06_area_m <- mask(banda_swir_18.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.06_m <- mask(banda_vis_NDSI_18.06, st_as_sf(AreaRitaglioCornoNero))

Q06_18 <- banda_vis_NDSI_18.06_m - banda_swir_18.06_area_m
B06_18 <- banda_vis_NDSI_18.06_m + banda_swir_18.06_area_m
NDSI_CornoNero_18.06_area <- Q06_18/B06_18

total_cells <- ncell(NDSI_CornoNero_18.06_area)
total_cells
freq(NDSI_CornoNero_18.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.06_area > 0.5, value = TRUE)[1, "count"]
cells_with_snow
percentage_snow_18.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.06)
contatore <- contatore +1

NDSI_CornoNero_18.06_area_df <- as.data.frame(NDSI_CornoNero_18.06_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_18.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()


if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2017_2018)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2017_2018 <- inverno2017_2018 +1
}

percentuali_righe

#----- FINE TERZO ANNO ------


#mese 18.09
banda_swir_18.09 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.09.26 NDSI.tiff")
Corno_Nero_18.09_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.09_CN)
crs_s <- crs(banda_swir_18.09)
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.09_CN <- project(Corno_Nero_18.09_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.09_CN <- project(Corno_Nero_18.09_CN, crs_p)
}
banda_swir_18.09_area <- crop(banda_swir_18.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.09_area <- crop(Corno_Nero_18.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.09 <- CN_CornoNero_18.09_area[[3]]
banda_vis_NDSI_18.09 <- terra::resample(banda_vis_NDSI_18.09, banda_swir_18.09_area, 
                                        method = "bilinear" )
banda_swir_18.09_area_m <- mask(banda_swir_18.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.09_m <- mask(banda_vis_NDSI_18.09, st_as_sf(AreaRitaglioCornoNero))

Q09_18 <- banda_vis_NDSI_18.09_m - banda_swir_18.09_area_m
B09_18 <- banda_vis_NDSI_18.09_m + banda_swir_18.09_area_m
NDSI_CornoNero_18.09_area <- Q09_18/B09_18
total_cells <- ncell(NDSI_CornoNero_18.09_area)
freq(NDSI_CornoNero_18.09_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_18.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.09)
contatore <- contatore +1
NDSI_CornoNero_18.09_area_df <- as.data.frame(NDSI_CornoNero_18.09_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_18.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 18.10
banda_swir_18.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.10.04 NDSI.tiff")
Corno_Nero_18.10_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.10_CN)
crs_s <- crs(banda_swir_18.10)
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.10_CN <- project(Corno_Nero_18.10_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.10_CN <- project(Corno_Nero_18.10_CN, crs_p)
}
banda_swir_18.10_area <- crop(banda_swir_18.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.10_area <- crop(Corno_Nero_18.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.10 <- CN_CornoNero_18.10_area[[3]]
banda_vis_NDSI_18.10 <- terra::resample(banda_vis_NDSI_18.10, banda_swir_18.10_area, 
                                        method = "bilinear" )
banda_swir_18.10_area_m <- mask(banda_swir_18.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.10_m <- mask(banda_vis_NDSI_18.10, st_as_sf(AreaRitaglioCornoNero))

Q10_18 <- banda_vis_NDSI_18.10_m - banda_swir_18.10_area_m
B10_18 <- banda_vis_NDSI_18.10_m + banda_swir_18.10_area_m
NDSI_CornoNero_18.10_area <- Q10_18/B10_18

total_cells <- ncell(NDSI_CornoNero_18.10_area)
freq(NDSI_CornoNero_18.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_18.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.10)
contatore <- contatore +1
NDSI_CornoNero_18.10_area_df <- as.data.frame(NDSI_CornoNero_18.10_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_18.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()


#mese 18.11
banda_swir_18.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.11.28_NDSI.tiff")
Corno_Nero_18.11_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.11_CN)
crs_s <- crs(banda_swir_18.11)
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.11_CN <- project(Corno_Nero_18.11_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.11_CN <- project(Corno_Nero_18.11_CN, crs_p)
}
banda_swir_18.11_area <- crop(banda_swir_18.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.11_area <- crop(Corno_Nero_18.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.11 <- CN_CornoNero_18.11_area[[3]]
banda_vis_NDSI_18.11 <- terra::resample(banda_vis_NDSI_18.11, banda_swir_18.11_area, 
                                        method = "bilinear" )
banda_swir_18.11_area_m <- mask(banda_swir_18.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.11_m <- mask(banda_vis_NDSI_18.11, st_as_sf(AreaRitaglioCornoNero))
Q11_18 <- banda_vis_NDSI_18.11_m - banda_swir_18.11_area_m
B11_18 <- banda_vis_NDSI_18.11_m + banda_swir_18.11_area_m
NDSI_CornoNero_18.11_area <- Q11_18/B11_18
total_cells <- ncell(NDSI_CornoNero_18.11_area)
freq(NDSI_CornoNero_18.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_18.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.11)
contatore <- contatore +1
NDSI_CornoNero_18.11_area_df <- as.data.frame(NDSI_CornoNero_18.11_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_18.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 18.12
banda_swir_18.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.12.18 NDSI.tiff")
Corno_Nero_18.12_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_18.12_CN)
crs_s <- crs(banda_swir_18.12)
if(!identical(crs_v, crs_s)){
  Corno_Nero_18.12_CN <- project(Corno_Nero_18.12_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_18.12_CN <- project(Corno_Nero_18.12_CN, crs_p)
}
banda_swir_18.12_area <- crop(banda_swir_18.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_18.12_area <- crop(Corno_Nero_18.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.12 <- CN_CornoNero_18.12_area[[3]]
banda_vis_NDSI_18.12 <- terra::resample(banda_vis_NDSI_18.12, banda_swir_18.12_area, 
                                        method = "bilinear" )
banda_swir_18.12_area_m <- mask(banda_swir_18.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_18.12_m <- mask(banda_vis_NDSI_18.12, st_as_sf(AreaRitaglioCornoNero))
Q12_18 <- banda_vis_NDSI_18.12_m - banda_swir_18.12_area_m
B12_18 <- banda_vis_NDSI_18.12_m + banda_swir_18.12_area_m
NDSI_CornoNero_18.12_area <- Q12_18/B12_18
total_cells <- ncell(NDSI_CornoNero_18.12_area)
freq(NDSI_CornoNero_18.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_18.12_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_18.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_18.12)
contatore <- contatore +1
NDSI_CornoNero_18.12_area_df <- as.data.frame(NDSI_CornoNero_18.12_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_18.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_18.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2018", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 19.01
banda_swir_19.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.01.22 NDSI.tiff")
Corno_Nero_19.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.01_CN)
crs_s <- crs(banda_swir_19.01)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.01_CN <- project(Corno_Nero_19.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.01_CN <- project(Corno_Nero_19.01_CN, crs_p)
}
banda_swir_19.01_area <- crop(banda_swir_19.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.01_area <- crop(Corno_Nero_19.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.01 <- CN_CornoNero_19.01_area[[3]]
banda_vis_NDSI_19.01 <- terra::resample(banda_vis_NDSI_19.01, banda_swir_19.01_area, 
                                        method = "bilinear" )
banda_swir_19.01_area_m <- mask(banda_swir_19.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.01_m <- mask(banda_vis_NDSI_19.01, st_as_sf(AreaRitaglioCornoNero))
Q01_19 <- banda_vis_NDSI_19.01_m - banda_swir_19.01_area_m
B01_19 <- banda_vis_NDSI_19.01_m + banda_swir_19.01_area_m
NDSI_CornoNero_19.01_area <- Q01_19/B01_19
total_cells <- ncell(NDSI_CornoNero_19.01_area)
freq(NDSI_CornoNero_19.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_19.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.01)
contatore <- contatore +1
NDSI_CornoNero_19.01_area_df <- as.data.frame(NDSI_CornoNero_19.01_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 19.02
banda_swir_19.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.02.06 NDSI.tiff")
Corno_Nero_19.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.02_CN)
crs_s <- crs(banda_swir_19.02)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.02_CN <- project(Corno_Nero_19.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.02_CN <- project(Corno_Nero_19.02_CN, crs_p)
}
banda_swir_19.02_area <- crop(banda_swir_19.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.02_area <- crop(Corno_Nero_19.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.02 <- CN_CornoNero_19.02_area[[3]]
banda_vis_NDSI_19.02 <- terra::resample(banda_vis_NDSI_19.02, banda_swir_19.02_area, 
                                        method = "bilinear" )
banda_swir_19.02_area_m <- mask(banda_swir_19.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.02_m <- mask(banda_vis_NDSI_19.02, st_as_sf(AreaRitaglioCornoNero))
Q02_19 <- banda_vis_NDSI_19.02_m - banda_swir_19.02_area_m
B02_19 <- banda_vis_NDSI_19.02_m + banda_swir_19.02_area_m
NDSI_CornoNero_19.02_area <- Q02_19/B02_19
total_cells <- ncell(NDSI_CornoNero_19.02_area)
freq(NDSI_CornoNero_19.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_19.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.02)
contatore <- contatore +1
NDSI_CornoNero_19.02_area_df <- as.data.frame(NDSI_CornoNero_19.02_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 19.03
banda_swir_19.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.03.20 NDSI.tiff")
Corno_Nero_19.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.03_CN)
crs_s <- crs(banda_swir_19.03)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.03_CN <- project(Corno_Nero_19.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.03_CN <- project(Corno_Nero_19.03_CN, crs_p)
}
banda_swir_19.03_area <- crop(banda_swir_19.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.03_area <- crop(Corno_Nero_19.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.03 <- CN_CornoNero_19.03_area[[3]]
banda_vis_NDSI_19.03 <- terra::resample(banda_vis_NDSI_19.03, banda_swir_19.03_area, 
                                        method = "bilinear" )
banda_swir_19.03_area_m <- mask(banda_swir_19.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.03_m <- mask(banda_vis_NDSI_19.03, st_as_sf(AreaRitaglioCornoNero))
Q03_19 <- banda_vis_NDSI_19.03_m - banda_swir_19.03_area_m
B03_19 <- banda_vis_NDSI_19.03_m + banda_swir_19.03_area_m
NDSI_CornoNero_19.03_area <- Q03_19/B03_19
total_cells <- ncell(NDSI_CornoNero_19.03_area)
freq(NDSI_CornoNero_19.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_19.03_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.03)
contatore <- contatore +1
NDSI_CornoNero_19.03_area_df <- as.data.frame(NDSI_CornoNero_19.03_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 19.04
banda_swir_19.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.04.22 NDSI.tiff")
Corno_Nero_19.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.04_CN)
crs_s <- crs(banda_swir_19.04)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.04_CN <- project(Corno_Nero_19.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.04_CN <- project(Corno_Nero_19.04_CN, crs_p)
}
banda_swir_19.04_area <- crop(banda_swir_19.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.04_area <- crop(Corno_Nero_19.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.04 <- CN_CornoNero_19.04_area[[3]]
banda_vis_NDSI_19.04 <- terra::resample(banda_vis_NDSI_19.04, banda_swir_19.04_area, 
                                        method = "bilinear" )
banda_swir_19.04_area_m <- mask(banda_swir_19.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.04_m <- mask(banda_vis_NDSI_19.04, st_as_sf(AreaRitaglioCornoNero))
Q04_19 <- banda_vis_NDSI_19.04_m - banda_swir_19.04_area_m
B04_19 <- banda_vis_NDSI_19.04_m + banda_swir_19.04_area_m
NDSI_CornoNero_19.04_area <- Q04_19/B04_19
total_cells <- ncell(NDSI_CornoNero_19.04_area)
freq(NDSI_CornoNero_19.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_19.04_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.04)
contatore <- contatore +1
NDSI_CornoNero_19.04_area_df <- as.data.frame(NDSI_CornoNero_19.04_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 19.05
banda_swir_19.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.05.24 NDSI.tiff")
Corno_Nero_19.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.05_CN)
crs_s <- crs(banda_swir_19.05)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.05_CN <- project(Corno_Nero_19.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.05_CN <- project(Corno_Nero_19.05_CN, crs_p)
}
banda_swir_19.05_area <- crop(banda_swir_19.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.05_area <- crop(Corno_Nero_19.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.05 <- CN_CornoNero_19.05_area[[3]]
banda_vis_NDSI_19.05 <- terra::resample(banda_vis_NDSI_19.05, banda_swir_19.05_area, 
                                        method = "bilinear" )
banda_swir_19.05_area_m <- mask(banda_swir_19.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.05_m <- mask(banda_vis_NDSI_19.05, st_as_sf(AreaRitaglioCornoNero))
Q05_19 <- banda_vis_NDSI_19.05_m - banda_swir_19.05_area_m
B05_19 <- banda_vis_NDSI_19.05_m + banda_swir_19.05_area_m
NDSI_CornoNero_19.05_area <- Q05_19/B05_19
total_cells <- ncell(NDSI_CornoNero_19.05_area)
freq(NDSI_CornoNero_19.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_19.05_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.05)
contatore <- contatore +1
NDSI_CornoNero_19.05_area_df <- as.data.frame(NDSI_CornoNero_19.05_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 19.06
banda_swir_19.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.06.28 NDSI.tiff")
Corno_Nero_19.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.06_CN)
crs_s <- crs(banda_swir_19.06)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.06_CN <- project(Corno_Nero_19.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.06_CN <- project(Corno_Nero_19.06_CN, crs_p)
}
banda_swir_19.06_area <- crop(banda_swir_19.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.06_area <- crop(Corno_Nero_19.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.06 <- CN_CornoNero_19.06_area[[3]]
banda_vis_NDSI_19.06 <- terra::resample(banda_vis_NDSI_19.06, banda_swir_19.06_area, 
                                        method = "bilinear" )
banda_swir_19.06_area_m <- mask(banda_swir_19.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.06_m <- mask(banda_vis_NDSI_19.06, st_as_sf(AreaRitaglioCornoNero))
Q06_19 <- banda_vis_NDSI_19.06_m - banda_swir_19.06_area_m
B06_19 <- banda_vis_NDSI_19.06_m + banda_swir_19.06_area_m
NDSI_CornoNero_19.06_area <- Q06_19/B06_19
total_cells <- ncell(NDSI_CornoNero_19.06_area)
freq(NDSI_CornoNero_19.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_19.06_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.06)
contatore <- contatore +1
NDSI_CornoNero_19.06_area_df <- as.data.frame(NDSI_CornoNero_19.06_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2018_2019)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2018_2019 <- inverno2018_2019 +1
}

percentuali_righe

#----- FINE QUARTO ANNO ------


#mese 19.09
banda_swir_19.09 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.09.16 NDSI.tiff")
Corno_Nero_19.09_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.09_CN)
crs_s <- crs(banda_swir_19.09)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.09_CN <- project(Corno_Nero_19.09_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.09_CN <- project(Corno_Nero_19.09_CN, crs_p)
}
banda_swir_19.09_area <- crop(banda_swir_19.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.09_area <- crop(Corno_Nero_19.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.09 <- CN_CornoNero_19.09_area[[3]]
banda_vis_NDSI_19.09 <- terra::resample(banda_vis_NDSI_19.09, banda_swir_19.09_area, 
                                        method = "bilinear" )
banda_swir_19.09_area_m <- mask(banda_swir_19.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.09_m <- mask(banda_vis_NDSI_19.09, st_as_sf(AreaRitaglioCornoNero))

Q09_19 <- banda_vis_NDSI_19.09_m - banda_swir_19.09_area_m
B09_19 <- banda_vis_NDSI_19.09_m + banda_swir_19.09_area_m
NDSI_CornoNero_19.09_area <- Q09_19/B09_19
total_cells <- ncell(NDSI_CornoNero_19.09_area)
freq(NDSI_CornoNero_19.09_area, value = NA)[1, "count"] #.......
cells_with_snow <- freq(NDSI_CornoNero_19.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.09)
contatore <- contatore +1
NDSI_CornoNero_19.09_area_df <- as.data.frame(NDSI_CornoNero_19.09_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 19.10
banda_swir_19.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.10.11 NDSI.tiff")
Corno_Nero_19.10_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.10_CN)
crs_s <- crs(banda_swir_19.10)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.10_CN <- project(Corno_Nero_19.10_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.10_CN <- project(Corno_Nero_19.10_CN, crs_p)
}
banda_swir_19.10_area <- crop(banda_swir_19.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.10_area <- crop(Corno_Nero_19.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.10 <- CN_CornoNero_19.10_area[[3]]
banda_vis_NDSI_19.10 <- terra::resample(banda_vis_NDSI_19.10, banda_swir_19.10_area, 
                                        method = "bilinear" )
banda_swir_19.10_area_m <- mask(banda_swir_19.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.10_m <- mask(banda_vis_NDSI_19.10, st_as_sf(AreaRitaglioCornoNero))

Q10_19 <- banda_vis_NDSI_19.10_m - banda_swir_19.10_area_m
B10_19 <- banda_vis_NDSI_19.10_m + banda_swir_19.10_area_m
NDSI_CornoNero_19.10_area <- Q10_19/B10_19

total_cells <- ncell(NDSI_CornoNero_19.10_area)
freq(NDSI_CornoNero_19.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_19.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.10)
contatore <- contatore +1
NDSI_CornoNero_19.10_area_df <- as.data.frame(NDSI_CornoNero_19.10_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()


#mese 19.11
banda_swir_19.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/18.11.28_NDSI.tiff")
Corno_Nero_19.11_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/18.08.27 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.11_CN)
crs_s <- crs(banda_swir_19.11)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.11_CN <- project(Corno_Nero_19.11_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.11_CN <- project(Corno_Nero_19.11_CN, crs_p)
}
banda_swir_19.11_area <- crop(banda_swir_19.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.11_area <- crop(Corno_Nero_19.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.11 <- CN_CornoNero_19.11_area[[3]]
banda_vis_NDSI_19.11 <- terra::resample(banda_vis_NDSI_19.11, banda_swir_19.11_area, 
                                        method = "bilinear" )
banda_swir_19.11_area_m <- mask(banda_swir_19.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.11_m <- mask(banda_vis_NDSI_19.11, st_as_sf(AreaRitaglioCornoNero))
Q11_19 <- banda_vis_NDSI_19.11_m - banda_swir_19.11_area_m
B11_19 <- banda_vis_NDSI_19.11_m + banda_swir_19.11_area_m
NDSI_CornoNero_19.11_area <- Q11_19/B11_19
total_cells <- ncell(NDSI_CornoNero_19.11_area)
freq(NDSI_CornoNero_19.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_19.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.11)
contatore <- contatore +1
NDSI_CornoNero_19.11_area_df <- as.data.frame(NDSI_CornoNero_19.11_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 19.12
banda_swir_19.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.12.10 NDSI.tiff")
Corno_Nero_19.12_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_19.12_CN)
crs_s <- crs(banda_swir_19.12)
if(!identical(crs_v, crs_s)){
  Corno_Nero_19.12_CN <- project(Corno_Nero_19.12_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_19.12_CN <- project(Corno_Nero_19.12_CN, crs_p)
}
banda_swir_19.12_area <- crop(banda_swir_19.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_19.12_area <- crop(Corno_Nero_19.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.12 <- CN_CornoNero_19.12_area[[3]]
banda_vis_NDSI_19.12 <- terra::resample(banda_vis_NDSI_19.12, banda_swir_19.12_area, 
                                        method = "bilinear" )
banda_swir_19.12_area_m <- mask(banda_swir_19.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_19.12_m <- mask(banda_vis_NDSI_19.12, st_as_sf(AreaRitaglioCornoNero))
Q12_19 <- banda_vis_NDSI_19.12_m - banda_swir_19.12_area_m
B12_19 <- banda_vis_NDSI_19.12_m + banda_swir_19.12_area_m
NDSI_CornoNero_19.12_area <- Q12_19/B12_19
total_cells <- ncell(NDSI_CornoNero_19.12_area)
freq(NDSI_CornoNero_19.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_19.12_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_19.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_19.12)
contatore <- contatore +1
NDSI_CornoNero_19.12_area_df <- as.data.frame(NDSI_CornoNero_19.12_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_19.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_19.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2019", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 20.01
banda_swir_20.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/20.01.07 NDSI.tiff")
Corno_Nero_20.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/20.08.01 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.01_CN)
crs_s <- crs(banda_swir_20.01)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.01_CN <- project(Corno_Nero_20.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.01_CN <- project(Corno_Nero_20.01_CN, crs_p)
}
banda_swir_20.01_area <- crop(banda_swir_20.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.01_area <- crop(Corno_Nero_20.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.01 <- CN_CornoNero_20.01_area[[3]]
banda_vis_NDSI_20.01 <- terra::resample(banda_vis_NDSI_20.01, banda_swir_20.01_area, 
                                        method = "bilinear" )
banda_swir_20.01_area_m <- mask(banda_swir_20.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.01_m <- mask(banda_vis_NDSI_20.01, st_as_sf(AreaRitaglioCornoNero))
Q01_20 <- banda_vis_NDSI_20.01_m - banda_swir_20.01_area_m
B01_20 <- banda_vis_NDSI_20.01_m + banda_swir_20.01_area_m
NDSI_CornoNero_20.01_area <- Q01_20/B01_20
total_cells <- ncell(NDSI_CornoNero_20.01_area)
freq(NDSI_CornoNero_20.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_20.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.01)
contatore <- contatore +1
NDSI_CornoNero_20.01_area_df <- as.data.frame(NDSI_CornoNero_20.01_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 20.02
banda_swir_20.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/20.02.11 NDSI.tiff")
Corno_Nero_20.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/20.08.01 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.02_CN)
crs_s <- crs(banda_swir_20.02)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.02_CN <- project(Corno_Nero_20.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.02_CN <- project(Corno_Nero_20.02_CN, crs_p)
}
banda_swir_20.02_area <- crop(banda_swir_20.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.02_area <- crop(Corno_Nero_20.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.02 <- CN_CornoNero_20.02_area[[3]]
banda_vis_NDSI_20.02 <- terra::resample(banda_vis_NDSI_20.02, banda_swir_20.02_area, 
                                        method = "bilinear" )
banda_swir_20.02_area_m <- mask(banda_swir_20.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.02_m <- mask(banda_vis_NDSI_20.02, st_as_sf(AreaRitaglioCornoNero))
Q02_20 <- banda_vis_NDSI_20.02_m - banda_swir_20.02_area_m
B02_20 <- banda_vis_NDSI_20.02_m + banda_swir_20.02_area_m
NDSI_CornoNero_20.02_area <- Q02_20/B02_20
total_cells <- ncell(NDSI_CornoNero_20.02_area)
freq(NDSI_CornoNero_20.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_20.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.02)
contatore <- contatore +1
NDSI_CornoNero_20.02_area_df <- as.data.frame(NDSI_CornoNero_20.02_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 20.03
banda_swir_20.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/20.03.17 NDSI.tiff")
Corno_Nero_20.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/20.08.01 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.03_CN)
crs_s <- crs(banda_swir_20.03)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.03_CN <- project(Corno_Nero_20.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.03_CN <- project(Corno_Nero_20.03_CN, crs_p)
}
banda_swir_20.03_area <- crop(banda_swir_20.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.03_area <- crop(Corno_Nero_20.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.03 <- CN_CornoNero_20.03_area[[3]]
banda_vis_NDSI_20.03 <- terra::resample(banda_vis_NDSI_20.03, banda_swir_20.03_area, 
                                        method = "bilinear" )
banda_swir_20.03_area_m <- mask(banda_swir_20.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.03_m <- mask(banda_vis_NDSI_20.03, st_as_sf(AreaRitaglioCornoNero))
Q03_20 <- banda_vis_NDSI_20.03_m - banda_swir_20.03_area_m
B03_20 <- banda_vis_NDSI_20.03_m + banda_swir_20.03_area_m
NDSI_CornoNero_20.03_area <- Q03_20/B03_20
total_cells <- ncell(NDSI_CornoNero_20.03_area)
freq(NDSI_CornoNero_20.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_20.03_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.03)
contatore <- contatore +1
NDSI_CornoNero_20.03_area_df <- as.data.frame(NDSI_CornoNero_20.03_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 20.04
banda_swir_20.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/20.04.08 NDSI.tiff")
Corno_Nero_20.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/20.08.01 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.04_CN)
crs_s <- crs(banda_swir_20.04)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.04_CN <- project(Corno_Nero_20.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.04_CN <- project(Corno_Nero_20.04_CN, crs_p)
}
banda_swir_20.04_area <- crop(banda_swir_20.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.04_area <- crop(Corno_Nero_20.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.04 <- CN_CornoNero_20.04_area[[3]]
banda_vis_NDSI_20.04 <- terra::resample(banda_vis_NDSI_20.04, banda_swir_20.04_area, 
                                        method = "bilinear" )
banda_swir_20.04_area_m <- mask(banda_swir_20.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.04_m <- mask(banda_vis_NDSI_20.04, st_as_sf(AreaRitaglioCornoNero))
Q04_20 <- banda_vis_NDSI_20.04_m - banda_swir_20.04_area_m
B04_20 <- banda_vis_NDSI_20.04_m + banda_swir_20.04_area_m
NDSI_CornoNero_20.04_area <- Q04_20/B04_20
total_cells <- ncell(NDSI_CornoNero_20.04_area)
freq(NDSI_CornoNero_20.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_20.04_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.04)
contatore <- contatore +1
NDSI_CornoNero_20.04_area_df <- as.data.frame(NDSI_CornoNero_20.04_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 20.05
banda_swir_20.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/20.05.21 NDSI.tiff")
Corno_Nero_20.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/20.08.01 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.05_CN)
crs_s <- crs(banda_swir_20.05)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.05_CN <- project(Corno_Nero_20.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.05_CN <- project(Corno_Nero_20.05_CN, crs_p)
}
banda_swir_20.05_area <- crop(banda_swir_20.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.05_area <- crop(Corno_Nero_20.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.05 <- CN_CornoNero_20.05_area[[3]]
banda_vis_NDSI_20.05 <- terra::resample(banda_vis_NDSI_20.05, banda_swir_20.05_area, 
                                        method = "bilinear" )
banda_swir_20.05_area_m <- mask(banda_swir_20.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.05_m <- mask(banda_vis_NDSI_20.05, st_as_sf(AreaRitaglioCornoNero))
Q05_20 <- banda_vis_NDSI_20.05_m - banda_swir_20.05_area_m
B05_20 <- banda_vis_NDSI_20.05_m + banda_swir_20.05_area_m
NDSI_CornoNero_20.05_area <- Q05_20/B05_20
total_cells <- ncell(NDSI_CornoNero_20.05_area)
freq(NDSI_CornoNero_20.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_20.05_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.05)
contatore <- contatore +1
NDSI_CornoNero_20.05_area_df <- as.data.frame(NDSI_CornoNero_20.05_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 20.06
banda_swir_20.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/20.06.02 NDSI.tiff")
Corno_Nero_20.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/20.08.01 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.06_CN)
crs_s <- crs(banda_swir_20.06)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.06_CN <- project(Corno_Nero_20.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.06_CN <- project(Corno_Nero_20.06_CN, crs_p)
}
banda_swir_20.06_area <- crop(banda_swir_20.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.06_area <- crop(Corno_Nero_20.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.06 <- CN_CornoNero_20.06_area[[3]]
banda_vis_NDSI_20.06 <- terra::resample(banda_vis_NDSI_20.06, banda_swir_20.06_area, 
                                        method = "bilinear" )
banda_swir_20.06_area_m <- mask(banda_swir_20.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.06_m <- mask(banda_vis_NDSI_20.06, st_as_sf(AreaRitaglioCornoNero))
Q06_20 <- banda_vis_NDSI_20.06_m - banda_swir_20.06_area_m
B06_20 <- banda_vis_NDSI_20.06_m + banda_swir_20.06_area_m
NDSI_CornoNero_20.06_area <- Q06_20/B06_20
total_cells <- ncell(NDSI_CornoNero_20.06_area)
freq(NDSI_CornoNero_20.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_20.06_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.06)
contatore <- contatore +1
NDSI_CornoNero_20.06_area_df <- as.data.frame(NDSI_CornoNero_20.06_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2019_2020)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2019_2020 <- inverno2019_2020 +1
}

percentuali_righe

#----- FINE QUINTO ANNO ------


#mese 20.09
banda_swir_20.09 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/20.09.30 NDSI.tiff")
Corno_Nero_20.09_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/20.08.01 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.09_CN)
crs_s <- crs(banda_swir_20.09)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.09_CN <- project(Corno_Nero_20.09_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.09_CN <- project(Corno_Nero_20.09_CN, crs_p)
}
banda_swir_20.09_area <- crop(banda_swir_20.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.09_area <- crop(Corno_Nero_20.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.09 <- CN_CornoNero_20.09_area[[3]]
banda_vis_NDSI_20.09 <- terra::resample(banda_vis_NDSI_20.09, banda_swir_20.09_area, 
                                        method = "bilinear" )
banda_swir_20.09_area_m <- mask(banda_swir_20.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.09_m <- mask(banda_vis_NDSI_20.09, st_as_sf(AreaRitaglioCornoNero))

Q09_20 <- banda_vis_NDSI_20.09_m - banda_swir_20.09_area_m
B09_20 <- banda_vis_NDSI_20.09_m + banda_swir_20.09_area_m
NDSI_CornoNero_20.09_area <- Q09_20/B09_20
total_cells <- ncell(NDSI_CornoNero_20.09_area)
freq(NDSI_CornoNero_20.09_area, value = NA)[1, "count"] #.......
cells_with_snow <- freq(NDSI_CornoNero_20.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.09)
contatore <- contatore +1
NDSI_CornoNero_20.09_area_df <- as.data.frame(NDSI_CornoNero_20.09_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 20.10
banda_swir_20.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/19.10.11 NDSI.tiff")
Corno_Nero_20.10_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/19.06.26 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.10_CN)
crs_s <- crs(banda_swir_20.10)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.10_CN <- project(Corno_Nero_20.10_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.10_CN <- project(Corno_Nero_20.10_CN, crs_p)
}
banda_swir_20.10_area <- crop(banda_swir_20.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.10_area <- crop(Corno_Nero_20.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.10 <- CN_CornoNero_20.10_area[[3]]
banda_vis_NDSI_20.10 <- terra::resample(banda_vis_NDSI_20.10, banda_swir_20.10_area, 
                                        method = "bilinear" )
banda_swir_20.10_area_m <- mask(banda_swir_20.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.10_m <- mask(banda_vis_NDSI_20.10, st_as_sf(AreaRitaglioCornoNero))

Q10_20 <- banda_vis_NDSI_20.10_m - banda_swir_20.10_area_m
B10_20 <- banda_vis_NDSI_20.10_m + banda_swir_20.10_area_m
NDSI_CornoNero_20.10_area <- Q10_20/B10_20

total_cells <- ncell(NDSI_CornoNero_20.10_area)
freq(NDSI_CornoNero_20.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_20.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.10)
contatore <- contatore +1
NDSI_CornoNero_20.10_area_df <- as.data.frame(NDSI_CornoNero_20.10_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()


#mese 20.11
banda_swir_20.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/20.11.17 NDSI.tiff")
Corno_Nero_20.11_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/20.08.01 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.11_CN)
crs_s <- crs(banda_swir_20.11)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.11_CN <- project(Corno_Nero_20.11_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.11_CN <- project(Corno_Nero_20.11_CN, crs_p)
}
banda_swir_20.11_area <- crop(banda_swir_20.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.11_area <- crop(Corno_Nero_20.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.11 <- CN_CornoNero_20.11_area[[3]]
banda_vis_NDSI_20.11 <- terra::resample(banda_vis_NDSI_20.11, banda_swir_20.11_area, 
                                        method = "bilinear" )
banda_swir_20.11_area_m <- mask(banda_swir_20.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.11_m <- mask(banda_vis_NDSI_20.11, st_as_sf(AreaRitaglioCornoNero))
Q11_20 <- banda_vis_NDSI_20.11_m - banda_swir_20.11_area_m
B11_20 <- banda_vis_NDSI_20.11_m + banda_swir_20.11_area_m
NDSI_CornoNero_20.11_area <- Q11_20/B11_20
total_cells <- ncell(NDSI_CornoNero_20.11_area)
freq(NDSI_CornoNero_20.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_20.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.11)
contatore <- contatore +1
NDSI_CornoNero_20.11_area_df <- as.data.frame(NDSI_CornoNero_20.11_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 20.12
banda_swir_20.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/20.12.17 NDSI.tiff")
Corno_Nero_20.12_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/20.08.01 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_20.12_CN)
crs_s <- crs(banda_swir_20.12)
if(!identical(crs_v, crs_s)){
  Corno_Nero_20.12_CN <- project(Corno_Nero_20.12_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_20.12_CN <- project(Corno_Nero_20.12_CN, crs_p)
}
banda_swir_20.12_area <- crop(banda_swir_20.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_20.12_area <- crop(Corno_Nero_20.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.12 <- CN_CornoNero_20.12_area[[3]]
banda_vis_NDSI_20.12 <- terra::resample(banda_vis_NDSI_20.12, banda_swir_20.12_area, 
                                        method = "bilinear" )
banda_swir_20.12_area_m <- mask(banda_swir_20.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_20.12_m <- mask(banda_vis_NDSI_20.12, st_as_sf(AreaRitaglioCornoNero))
Q12_20 <- banda_vis_NDSI_20.12_m - banda_swir_20.12_area_m
B12_20 <- banda_vis_NDSI_20.12_m + banda_swir_20.12_area_m
NDSI_CornoNero_20.12_area <- Q12_20/B12_20
total_cells <- ncell(NDSI_CornoNero_20.12_area)
freq(NDSI_CornoNero_20.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_20.12_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_20.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_20.12)
contatore <- contatore +1
NDSI_CornoNero_20.12_area_df <- as.data.frame(NDSI_CornoNero_20.12_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_20.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_20.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2020", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 21.01
banda_swir_21.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.01.11 NDSI.tiff")
Corno_Nero_21.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.01_CN)
crs_s <- crs(banda_swir_21.01)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.01_CN <- project(Corno_Nero_21.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.01_CN <- project(Corno_Nero_21.01_CN, crs_p)
}
banda_swir_21.01_area <- crop(banda_swir_21.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.01_area <- crop(Corno_Nero_21.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.01 <- CN_CornoNero_21.01_area[[3]]
banda_vis_NDSI_21.01 <- terra::resample(banda_vis_NDSI_21.01, banda_swir_21.01_area, 
                                        method = "bilinear" )
banda_swir_21.01_area_m <- mask(banda_swir_21.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.01_m <- mask(banda_vis_NDSI_21.01, st_as_sf(AreaRitaglioCornoNero))
Q01_21 <- banda_vis_NDSI_21.01_m - banda_swir_21.01_area_m
B01_21 <- banda_vis_NDSI_21.01_m + banda_swir_21.01_area_m
NDSI_CornoNero_21.01_area <- Q01_21/B01_21
total_cells <- ncell(NDSI_CornoNero_21.01_area)
freq(NDSI_CornoNero_21.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_21.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.01)
contatore <- contatore +1
NDSI_CornoNero_21.01_area_df <- as.data.frame(NDSI_CornoNero_21.01_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 21.02
banda_swir_21.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.02.17 NDSI.tiff")
Corno_Nero_21.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.02_CN)
crs_s <- crs(banda_swir_21.02)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.02_CN <- project(Corno_Nero_21.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.02_CN <- project(Corno_Nero_21.02_CN, crs_p)
}
banda_swir_21.02_area <- crop(banda_swir_21.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.02_area <- crop(Corno_Nero_21.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.02 <- CN_CornoNero_21.02_area[[3]]
banda_vis_NDSI_21.02 <- terra::resample(banda_vis_NDSI_21.02, banda_swir_21.02_area, 
                                        method = "bilinear" )
banda_swir_21.02_area_m <- mask(banda_swir_21.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.02_m <- mask(banda_vis_NDSI_21.02, st_as_sf(AreaRitaglioCornoNero))
Q02_21 <- banda_vis_NDSI_21.02_m - banda_swir_21.02_area_m
B02_21 <- banda_vis_NDSI_21.02_m + banda_swir_21.02_area_m
NDSI_CornoNero_21.02_area <- Q02_21/B02_21
total_cells <- ncell(NDSI_CornoNero_21.02_area)
freq(NDSI_CornoNero_21.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_21.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.02)
contatore <- contatore +1
NDSI_CornoNero_21.02_area_df <- as.data.frame(NDSI_CornoNero_21.02_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 21.03
banda_swir_21.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.03.24 NDSI.tiff")
Corno_Nero_21.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.03_CN)
crs_s <- crs(banda_swir_21.03)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.03_CN <- project(Corno_Nero_21.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.03_CN <- project(Corno_Nero_21.03_CN, crs_p)
}
banda_swir_21.03_area <- crop(banda_swir_21.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.03_area <- crop(Corno_Nero_21.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.03 <- CN_CornoNero_21.03_area[[3]]
banda_vis_NDSI_21.03 <- terra::resample(banda_vis_NDSI_21.03, banda_swir_21.03_area, 
                                        method = "bilinear" )
banda_swir_21.03_area_m <- mask(banda_swir_21.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.03_m <- mask(banda_vis_NDSI_21.03, st_as_sf(AreaRitaglioCornoNero))
Q03_21 <- banda_vis_NDSI_21.03_m - banda_swir_21.03_area_m
B03_21 <- banda_vis_NDSI_21.03_m + banda_swir_21.03_area_m
NDSI_CornoNero_21.03_area <- Q03_21/B03_21
total_cells <- ncell(NDSI_CornoNero_21.03_area)
freq(NDSI_CornoNero_21.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_21.03_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.03)
contatore <- contatore +1
NDSI_CornoNero_21.03_area_df <- as.data.frame(NDSI_CornoNero_21.03_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 21.04
banda_swir_21.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.04.08 NDSI.tiff")
Corno_Nero_21.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.04_CN)
crs_s <- crs(banda_swir_21.04)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.04_CN <- project(Corno_Nero_21.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.04_CN <- project(Corno_Nero_21.04_CN, crs_p)
}
banda_swir_21.04_area <- crop(banda_swir_21.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.04_area <- crop(Corno_Nero_21.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.04 <- CN_CornoNero_21.04_area[[3]]
banda_vis_NDSI_21.04 <- terra::resample(banda_vis_NDSI_21.04, banda_swir_21.04_area, 
                                        method = "bilinear" )
banda_swir_21.04_area_m <- mask(banda_swir_21.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.04_m <- mask(banda_vis_NDSI_21.04, st_as_sf(AreaRitaglioCornoNero))
Q04_21 <- banda_vis_NDSI_21.04_m - banda_swir_21.04_area_m
B04_21 <- banda_vis_NDSI_21.04_m + banda_swir_21.04_area_m
NDSI_CornoNero_21.04_area <- Q04_21/B04_21
total_cells <- ncell(NDSI_CornoNero_21.04_area)
freq(NDSI_CornoNero_21.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_21.04_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.04)
contatore <- contatore +1
NDSI_CornoNero_21.04_area_df <- as.data.frame(NDSI_CornoNero_21.04_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 21.05
banda_swir_21.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.05.26 NDSI.tiff")
Corno_Nero_21.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.05_CN)
crs_s <- crs(banda_swir_21.05)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.05_CN <- project(Corno_Nero_21.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.05_CN <- project(Corno_Nero_21.05_CN, crs_p)
}
banda_swir_21.05_area <- crop(banda_swir_21.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.05_area <- crop(Corno_Nero_21.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.05 <- CN_CornoNero_21.05_area[[3]]
banda_vis_NDSI_21.05 <- terra::resample(banda_vis_NDSI_21.05, banda_swir_21.05_area, 
                                        method = "bilinear" )
banda_swir_21.05_area_m <- mask(banda_swir_21.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.05_m <- mask(banda_vis_NDSI_21.05, st_as_sf(AreaRitaglioCornoNero))
Q05_21 <- banda_vis_NDSI_21.05_m - banda_swir_21.05_area_m
B05_21 <- banda_vis_NDSI_21.05_m + banda_swir_21.05_area_m
NDSI_CornoNero_21.05_area <- Q05_21/B05_21
total_cells <- ncell(NDSI_CornoNero_21.05_area)
freq(NDSI_CornoNero_21.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_21.05_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.05)
contatore <- contatore +1
NDSI_CornoNero_21.05_area_df <- as.data.frame(NDSI_CornoNero_21.05_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 21.06
banda_swir_21.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.06.15 NDSI.tiff")
Corno_Nero_21.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.06_CN)
crs_s <- crs(banda_swir_21.06)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.06_CN <- project(Corno_Nero_21.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.06_CN <- project(Corno_Nero_21.06_CN, crs_p)
}
banda_swir_21.06_area <- crop(banda_swir_21.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.06_area <- crop(Corno_Nero_21.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.06 <- CN_CornoNero_21.06_area[[3]]
banda_vis_NDSI_21.06 <- terra::resample(banda_vis_NDSI_21.06, banda_swir_21.06_area, 
                                        method = "bilinear" )
banda_swir_21.06_area_m <- mask(banda_swir_21.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.06_m <- mask(banda_vis_NDSI_21.06, st_as_sf(AreaRitaglioCornoNero))
Q06_21 <- banda_vis_NDSI_21.06_m - banda_swir_21.06_area_m
B06_21 <- banda_vis_NDSI_21.06_m + banda_swir_21.06_area_m
NDSI_CornoNero_21.06_area <- Q06_21/B06_21
total_cells <- ncell(NDSI_CornoNero_21.06_area)
freq(NDSI_CornoNero_21.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_21.06_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.06)
contatore <- contatore +1
NDSI_CornoNero_21.06_area_df <- as.data.frame(NDSI_CornoNero_21.06_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2020_2021)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2020_2021 <- inverno2020_2021 +1
}

percentuali_righe

#----- FINE SESTO ANNO ------


#mese 21.09
banda_swir_21.09 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.09.23 NDSI.tiff")
Corno_Nero_21.09_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.09_CN)
crs_s <- crs(banda_swir_21.09)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.09_CN <- project(Corno_Nero_21.09_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.09_CN <- project(Corno_Nero_21.09_CN, crs_p)
}
banda_swir_21.09_area <- crop(banda_swir_21.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.09_area <- crop(Corno_Nero_21.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.09 <- CN_CornoNero_21.09_area[[3]]
banda_vis_NDSI_21.09 <- terra::resample(banda_vis_NDSI_21.09, banda_swir_21.09_area, 
                                        method = "bilinear" )
banda_swir_21.09_area_m <- mask(banda_swir_21.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.09_m <- mask(banda_vis_NDSI_21.09, st_as_sf(AreaRitaglioCornoNero))

Q09_21 <- banda_vis_NDSI_21.09_m - banda_swir_21.09_area_m
B09_21 <- banda_vis_NDSI_21.09_m + banda_swir_21.09_area_m
NDSI_CornoNero_21.09_area <- Q09_21/B09_21
total_cells <- ncell(NDSI_CornoNero_21.09_area)
freq(NDSI_CornoNero_21.09_area, value = NA)[1, "count"] #.......
cells_with_snow <- freq(NDSI_CornoNero_21.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.09)
contatore <- contatore +1
NDSI_CornoNero_21.09_area_df <- as.data.frame(NDSI_CornoNero_21.09_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 21.10
banda_swir_21.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.10.18 NDSI.tiff")
Corno_Nero_21.10_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.10_CN)
crs_s <- crs(banda_swir_21.10)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.10_CN <- project(Corno_Nero_21.10_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.10_CN <- project(Corno_Nero_21.10_CN, crs_p)
}
banda_swir_21.10_area <- crop(banda_swir_21.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.10_area <- crop(Corno_Nero_21.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.10 <- CN_CornoNero_21.10_area[[3]]
banda_vis_NDSI_21.10 <- terra::resample(banda_vis_NDSI_21.10, banda_swir_21.10_area, 
                                        method = "bilinear" )
banda_swir_21.10_area_m <- mask(banda_swir_21.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.10_m <- mask(banda_vis_NDSI_21.10, st_as_sf(AreaRitaglioCornoNero))

Q10_21 <- banda_vis_NDSI_21.10_m - banda_swir_21.10_area_m
B10_21 <- banda_vis_NDSI_21.10_m + banda_swir_21.10_area_m
NDSI_CornoNero_21.10_area <- Q10_21/B10_21

total_cells <- ncell(NDSI_CornoNero_21.10_area)
freq(NDSI_CornoNero_21.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_21.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.10)
contatore <- contatore +1
NDSI_CornoNero_21.10_area_df <- as.data.frame(NDSI_CornoNero_21.10_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()


#mese 21.11
banda_swir_21.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.11.04 NDSI.tiff")
Corno_Nero_21.11_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.11_CN)
crs_s <- crs(banda_swir_21.11)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.11_CN <- project(Corno_Nero_21.11_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.11_CN <- project(Corno_Nero_21.11_CN, crs_p)
}
banda_swir_21.11_area <- crop(banda_swir_21.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.11_area <- crop(Corno_Nero_21.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.11 <- CN_CornoNero_21.11_area[[3]]
banda_vis_NDSI_21.11 <- terra::resample(banda_vis_NDSI_21.11, banda_swir_21.11_area, 
                                        method = "bilinear" )
banda_swir_21.11_area_m <- mask(banda_swir_20.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.11_m <- mask(banda_vis_NDSI_20.11, st_as_sf(AreaRitaglioCornoNero))
Q11_21 <- banda_vis_NDSI_21.11_m - banda_swir_21.11_area_m
B11_21 <- banda_vis_NDSI_21.11_m + banda_swir_21.11_area_m
NDSI_CornoNero_21.11_area <- Q11_21/B11_21
total_cells <- ncell(NDSI_CornoNero_21.11_area)
freq(NDSI_CornoNero_21.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_21.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.11)
contatore <- contatore +1
NDSI_CornoNero_21.11_area_df <- as.data.frame(NDSI_CornoNero_21.11_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 21.12
banda_swir_21.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/21.12.07 NDSI.tiff")
Corno_Nero_21.12_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/21.08.14 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_21.12_CN)
crs_s <- crs(banda_swir_21.12)
if(!identical(crs_v, crs_s)){
  Corno_Nero_21.12_CN <- project(Corno_Nero_21.12_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_21.12_CN <- project(Corno_Nero_21.12_CN, crs_p)
}
banda_swir_21.12_area <- crop(banda_swir_21.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_21.12_area <- crop(Corno_Nero_21.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.12 <- CN_CornoNero_21.12_area[[3]]
banda_vis_NDSI_21.12 <- terra::resample(banda_vis_NDSI_21.12, banda_swir_21.12_area, 
                                        method = "bilinear" )
banda_swir_21.12_area_m <- mask(banda_swir_21.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_21.12_m <- mask(banda_vis_NDSI_21.12, st_as_sf(AreaRitaglioCornoNero))
Q12_21 <- banda_vis_NDSI_21.12_m - banda_swir_21.12_area_m
B12_21 <- banda_vis_NDSI_21.12_m + banda_swir_21.12_area_m
NDSI_CornoNero_21.12_area <- Q12_21/B12_21
total_cells <- ncell(NDSI_CornoNero_21.12_area)
freq(NDSI_CornoNero_21.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_21.12_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_21.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_21.12)
contatore <- contatore +1
NDSI_CornoNero_21.12_area_df <- as.data.frame(NDSI_CornoNero_21.12_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_21.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_21.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2021", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.01
banda_swir_22.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.01.13 NDSI.tiff")
Corno_Nero_22.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.01_CN)
crs_s <- crs(banda_swir_22.01)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.01_CN <- project(Corno_Nero_22.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.01_CN <- project(Corno_Nero_22.01_CN, crs_p)
}
banda_swir_22.01_area <- crop(banda_swir_22.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.01_area <- crop(Corno_Nero_22.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.01 <- CN_CornoNero_22.01_area[[3]]
banda_vis_NDSI_22.01 <- terra::resample(banda_vis_NDSI_22.01, banda_swir_22.01_area, 
                                        method = "bilinear" )
banda_swir_22.01_area_m <- mask(banda_swir_22.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.01_m <- mask(banda_vis_NDSI_22.01, st_as_sf(AreaRitaglioCornoNero))
Q01_22 <- banda_vis_NDSI_22.01_m - banda_swir_22.01_area_m
B01_22 <- banda_vis_NDSI_22.01_m + banda_swir_22.01_area_m
NDSI_CornoNero_22.01_area <- Q01_22/B01_22
total_cells <- ncell(NDSI_CornoNero_22.01_area)
freq(NDSI_CornoNero_22.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.01)
contatore <- contatore +1
NDSI_CornoNero_22.01_area_df <- as.data.frame(NDSI_CornoNero_22.01_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.02
banda_swir_22.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.02.10 NDSI.tiff")
Corno_Nero_22.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.02_CN)
crs_s <- crs(banda_swir_22.02)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.02_CN <- project(Corno_Nero_22.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.02_CN <- project(Corno_Nero_22.02_CN, crs_p)
}
banda_swir_22.02_area <- crop(banda_swir_22.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.02_area <- crop(Corno_Nero_22.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.02 <- CN_CornoNero_22.02_area[[3]]
banda_vis_NDSI_22.02 <- terra::resample(banda_vis_NDSI_22.02, banda_swir_22.02_area, 
                                        method = "bilinear" )
banda_swir_22.02_area_m <- mask(banda_swir_22.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.02_m <- mask(banda_vis_NDSI_22.02, st_as_sf(AreaRitaglioCornoNero))
Q02_22 <- banda_vis_NDSI_22.02_m - banda_swir_22.02_area_m
B02_22 <- banda_vis_NDSI_22.02_m + banda_swir_22.02_area_m
NDSI_CornoNero_22.02_area <- Q02_22/B02_22
total_cells <- ncell(NDSI_CornoNero_22.02_area)
freq(NDSI_CornoNero_22.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.02)
contatore <- contatore +1
NDSI_CornoNero_22.02_area_df <- as.data.frame(NDSI_CornoNero_22.02_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.03
banda_swir_22.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.03.09 NDSI.tiff")
Corno_Nero_22.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.03_CN)
crs_s <- crs(banda_swir_22.03)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.03_CN <- project(Corno_Nero_22.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.03_CN <- project(Corno_Nero_22.03_CN, crs_p)
}
banda_swir_22.03_area <- crop(banda_swir_22.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.03_area <- crop(Corno_Nero_22.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.03 <- CN_CornoNero_22.03_area[[3]]
banda_vis_NDSI_22.03 <- terra::resample(banda_vis_NDSI_22.03, banda_swir_22.03_area, 
                                        method = "bilinear" )
banda_swir_22.03_area_m <- mask(banda_swir_22.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.03_m <- mask(banda_vis_NDSI_22.03, st_as_sf(AreaRitaglioCornoNero))
Q03_22 <- banda_vis_NDSI_22.03_m - banda_swir_22.03_area_m
B03_22 <- banda_vis_NDSI_22.03_m + banda_swir_22.03_area_m
NDSI_CornoNero_22.03_area <- Q03_22/B03_22
total_cells <- ncell(NDSI_CornoNero_22.03_area)
freq(NDSI_CornoNero_22.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.03_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.03)
contatore <- contatore +1
NDSI_CornoNero_22.03_area_df <- as.data.frame(NDSI_CornoNero_22.03_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.04
banda_swir_22.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.04.11 NDSI.tiff")
Corno_Nero_22.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.04_CN)
crs_s <- crs(banda_swir_22.04)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.04_CN <- project(Corno_Nero_22.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.04_CN <- project(Corno_Nero_22.04_CN, crs_p)
}
banda_swir_22.04_area <- crop(banda_swir_22.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.04_area <- crop(Corno_Nero_22.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.04 <- CN_CornoNero_22.04_area[[3]]
banda_vis_NDSI_22.04 <- terra::resample(banda_vis_NDSI_22.04, banda_swir_22.04_area, 
                                        method = "bilinear" )
banda_swir_22.04_area_m <- mask(banda_swir_22.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.04_m <- mask(banda_vis_NDSI_22.04, st_as_sf(AreaRitaglioCornoNero))
Q04_22 <- banda_vis_NDSI_22.04_m - banda_swir_22.04_area_m
B04_22 <- banda_vis_NDSI_22.04_m + banda_swir_22.04_area_m
NDSI_CornoNero_22.04_area <- Q04_22/B04_22
total_cells <- ncell(NDSI_CornoNero_22.04_area)
freq(NDSI_CornoNero_22.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.04_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.04)
contatore <- contatore +1
NDSI_CornoNero_22.04_area_df <- as.data.frame(NDSI_CornoNero_22.04_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.05
banda_swir_22.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.05.21 NDSI.tiff")
Corno_Nero_22.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.05_CN)
crs_s <- crs(banda_swir_22.05)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.05_CN <- project(Corno_Nero_22.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.05_CN <- project(Corno_Nero_22.05_CN, crs_p)
}
banda_swir_22.05_area <- crop(banda_swir_22.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.05_area <- crop(Corno_Nero_22.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.05 <- CN_CornoNero_22.05_area[[3]]
banda_vis_NDSI_22.05 <- terra::resample(banda_vis_NDSI_22.05, banda_swir_22.05_area, 
                                        method = "bilinear" )
banda_swir_22.05_area_m <- mask(banda_swir_22.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.05_m <- mask(banda_vis_NDSI_22.05, st_as_sf(AreaRitaglioCornoNero))
Q05_22 <- banda_vis_NDSI_22.05_m - banda_swir_22.05_area_m
B05_22 <- banda_vis_NDSI_22.05_m + banda_swir_22.05_area_m
NDSI_CornoNero_22.05_area <- Q05_22/B05_22
total_cells <- ncell(NDSI_CornoNero_22.05_area)
freq(NDSI_CornoNero_22.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.05_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.05)
contatore <- contatore +1
NDSI_CornoNero_22.05_area_df <- as.data.frame(NDSI_CornoNero_22.05_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.06
banda_swir_22.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.06.12 NDSI.tiff")
Corno_Nero_22.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.06_CN)
crs_s <- crs(banda_swir_22.06)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.06_CN <- project(Corno_Nero_22.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.06_CN <- project(Corno_Nero_22.06_CN, crs_p)
}
banda_swir_22.06_area <- crop(banda_swir_22.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.06_area <- crop(Corno_Nero_22.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.06 <- CN_CornoNero_22.06_area[[3]]
banda_vis_NDSI_22.06 <- terra::resample(banda_vis_NDSI_22.06, banda_swir_22.06_area, 
                                        method = "bilinear" )
banda_swir_22.06_area_m <- mask(banda_swir_22.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.06_m <- mask(banda_vis_NDSI_22.06, st_as_sf(AreaRitaglioCornoNero))
Q06_22 <- banda_vis_NDSI_22.06_m - banda_swir_22.06_area_m
B06_22 <- banda_vis_NDSI_22.06_m + banda_swir_22.06_area_m
NDSI_CornoNero_22.06_area <- Q06_22/B06_22
total_cells <- ncell(NDSI_CornoNero_22.06_area)
freq(NDSI_CornoNero_22.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.06_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.06)
contatore <- contatore +1
NDSI_CornoNero_22.06_area_df <- as.data.frame(NDSI_CornoNero_22.06_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2021_2022)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2021_2022 <- inverno2021_2022 +1
}

percentuali_righe

#----- FINE SETTIMO ANNO ------


#mese 22.09
banda_swir_22.09 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.09.13 NDSI.tiff")
Corno_Nero_22.09_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.09_CN)
crs_s <- crs(banda_swir_22.09)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.09_CN <- project(Corno_Nero_22.09_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.09_CN <- project(Corno_Nero_22.09_CN, crs_p)
}
banda_swir_22.09_area <- crop(banda_swir_22.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.09_area <- crop(Corno_Nero_22.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.09 <- CN_CornoNero_22.09_area[[3]]
banda_vis_NDSI_22.09 <- terra::resample(banda_vis_NDSI_22.09, banda_swir_22.09_area, 
                                        method = "bilinear" )
banda_swir_22.09_area_m <- mask(banda_swir_22.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.09_m <- mask(banda_vis_NDSI_22.09, st_as_sf(AreaRitaglioCornoNero))

Q09_22 <- banda_vis_NDSI_22.09_m - banda_swir_22.09_area_m
B09_22 <- banda_vis_NDSI_22.09_m + banda_swir_22.09_area_m
NDSI_CornoNero_22.09_area <- Q09_22/B09_22
total_cells <- ncell(NDSI_CornoNero_22.09_area)
freq(NDSI_CornoNero_22.09_area, value = NA)[1, "count"] #.......
cells_with_snow <- freq(NDSI_CornoNero_22.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.09)
contatore <- contatore +1
NDSI_CornoNero_22.09_area_df <- as.data.frame(NDSI_CornoNero_22.09_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.10
banda_swir_22.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.10.18 NDSI.tiff")
Corno_Nero_22.10_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.10_CN)
crs_s <- crs(banda_swir_22.10)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.10_CN <- project(Corno_Nero_22.10_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.10_CN <- project(Corno_Nero_22.10_CN, crs_p)
}
banda_swir_22.10_area <- crop(banda_swir_22.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.10_area <- crop(Corno_Nero_22.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.10 <- CN_CornoNero_22.10_area[[3]]
banda_vis_NDSI_22.10 <- terra::resample(banda_vis_NDSI_22.10, banda_swir_22.10_area, 
                                        method = "bilinear" )
banda_swir_22.10_area_m <- mask(banda_swir_22.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.10_m <- mask(banda_vis_NDSI_22.10, st_as_sf(AreaRitaglioCornoNero))

Q10_22 <- banda_vis_NDSI_22.10_m - banda_swir_22.10_area_m
B10_22 <- banda_vis_NDSI_22.10_m + banda_swir_22.10_area_m
NDSI_CornoNero_22.10_area <- Q10_22/B10_22

total_cells <- ncell(NDSI_CornoNero_22.10_area)
freq(NDSI_CornoNero_22.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.10)
contatore <- contatore +1
NDSI_CornoNero_22.10_area_df <- as.data.frame(NDSI_CornoNero_22.10_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()


#mese 22.11
banda_swir_22.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.11.19 NDSI.tiff")
Corno_Nero_22.11_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.11_CN)
crs_s <- crs(banda_swir_22.11)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.11_CN <- project(Corno_Nero_22.11_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.11_CN <- project(Corno_Nero_22.11_CN, crs_p)
}
banda_swir_22.11_area <- crop(banda_swir_22.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.11_area <- crop(Corno_Nero_22.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.11 <- CN_CornoNero_22.11_area[[3]]
banda_vis_NDSI_22.11 <- terra::resample(banda_vis_NDSI_22.11, banda_swir_22.11_area, 
                                        method = "bilinear" )
banda_swir_22.11_area_m <- mask(banda_swir_22.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.11_m <- mask(banda_vis_NDSI_22.11, st_as_sf(AreaRitaglioCornoNero))
Q11_22 <- banda_vis_NDSI_22.11_m - banda_swir_22.11_area_m
B11_22 <- banda_vis_NDSI_22.11_m + banda_swir_22.11_area_m
NDSI_CornoNero_22.11_area <- Q11_22/B11_22
total_cells <- ncell(NDSI_CornoNero_22.11_area)
freq(NDSI_CornoNero_22.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.11)
contatore <- contatore +1
NDSI_CornoNero_22.11_area_df <- as.data.frame(NDSI_CornoNero_22.11_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.12
banda_swir_22.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.12.07 NDSI.tiff")
Corno_Nero_22.12_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.12_CN)
crs_s <- crs(banda_swir_22.12)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.12_CN <- project(Corno_Nero_22.12_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.12_CN <- project(Corno_Nero_22.12_CN, crs_p)
}
banda_swir_22.12_area <- crop(banda_swir_22.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.12_area <- crop(Corno_Nero_22.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.12 <- CN_CornoNero_22.12_area[[3]]
banda_vis_NDSI_22.12 <- terra::resample(banda_vis_NDSI_22.12, banda_swir_22.12_area, 
                                        method = "bilinear" )
banda_swir_22.12_area_m <- mask(banda_swir_22.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.12_m <- mask(banda_vis_NDSI_22.12, st_as_sf(AreaRitaglioCornoNero))
Q12_22 <- banda_vis_NDSI_22.12_m - banda_swir_22.12_area_m
B12_22 <- banda_vis_NDSI_22.12_m + banda_swir_22.12_area_m
NDSI_CornoNero_22.12_area <- Q12_22/B12_22
total_cells <- ncell(NDSI_CornoNero_22.12_area)
freq(NDSI_CornoNero_22.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.12_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.12)
contatore <- contatore +1
NDSI_CornoNero_22.12_area_df <- as.data.frame(NDSI_CornoNero_22.12_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.01
banda_swir_23.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.01.21 NDSI.tiff")
Corno_Nero_23.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.01_CN)
crs_s <- crs(banda_swir_23.01)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.01_CN <- project(Corno_Nero_23.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.01_CN <- project(Corno_Nero_23.01_CN, crs_p)
}
banda_swir_23.01_area <- crop(banda_swir_23.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.01_area <- crop(Corno_Nero_23.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.01 <- CN_CornoNero_23.01_area[[3]]
banda_vis_NDSI_23.01 <- terra::resample(banda_vis_NDSI_23.01, banda_swir_23.01_area, 
                                        method = "bilinear" )
banda_swir_23.01_area_m <- mask(banda_swir_23.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.01_m <- mask(banda_vis_NDSI_23.01, st_as_sf(AreaRitaglioCornoNero))
Q01_23 <- banda_vis_NDSI_23.01_m - banda_swir_23.01_area_m
B01_23 <- banda_vis_NDSI_23.01_m + banda_swir_23.01_area_m
NDSI_CornoNero_23.01_area <- Q01_23/B01_23
total_cells <- ncell(NDSI_CornoNero_23.01_area)
freq(NDSI_CornoNero_23.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.01)
contatore <- contatore +1
NDSI_CornoNero_23.01_area_df <- as.data.frame(NDSI_CornoNero_23.01_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.02
banda_swir_23.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.02.07 NDSI.tiff")
Corno_Nero_23.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.02_CN)
crs_s <- crs(banda_swir_23.02)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.02_CN <- project(Corno_Nero_23.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.02_CN <- project(Corno_Nero_23.02_CN, crs_p)
}
banda_swir_23.02_area <- crop(banda_swir_23.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.02_area <- crop(Corno_Nero_23.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.02 <- CN_CornoNero_23.02_area[[3]]
banda_vis_NDSI_23.02 <- terra::resample(banda_vis_NDSI_23.02, banda_swir_23.02_area, 
                                        method = "bilinear" )
banda_swir_23.02_area_m <- mask(banda_swir_23.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.02_m <- mask(banda_vis_NDSI_23.02, st_as_sf(AreaRitaglioCornoNero))
Q02_23 <- banda_vis_NDSI_23.02_m - banda_swir_23.02_area_m
B02_23 <- banda_vis_NDSI_23.02_m + banda_swir_23.02_area_m
NDSI_CornoNero_23.02_area <- Q02_23/B02_23
total_cells <- ncell(NDSI_CornoNero_23.02_area)
freq(NDSI_CornoNero_23.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.02)
contatore <- contatore +1
NDSI_CornoNero_23.02_area_df <- as.data.frame(NDSI_CornoNero_23.02_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.03
banda_swir_23.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.03.17 NDSI.tiff")
Corno_Nero_23.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.03_CN)
crs_s <- crs(banda_swir_23.03)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.03_CN <- project(Corno_Nero_23.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.03_CN <- project(Corno_Nero_23.03_CN, crs_p)
}
banda_swir_23.03_area <- crop(banda_swir_23.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.03_area <- crop(Corno_Nero_23.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.03 <- CN_CornoNero_23.03_area[[3]]
banda_vis_NDSI_23.03 <- terra::resample(banda_vis_NDSI_23.03, banda_swir_23.03_area, 
                                        method = "bilinear" )
banda_swir_23.03_area_m <- mask(banda_swir_23.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.03_m <- mask(banda_vis_NDSI_23.03, st_as_sf(AreaRitaglioCornoNero))
Q03_23 <- banda_vis_NDSI_23.03_m - banda_swir_23.03_area_m
B03_23 <- banda_vis_NDSI_23.03_m + banda_swir_23.03_area_m
NDSI_CornoNero_23.03_area <- Q03_23/B03_23
total_cells <- ncell(NDSI_CornoNero_23.03_area)
freq(NDSI_CornoNero_23.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.03_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.03)
contatore <- contatore +1
NDSI_CornoNero_23.03_area_df <- as.data.frame(NDSI_CornoNero_23.03_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.04
banda_swir_23.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.04.03 NDSI.tiff")
Corno_Nero_23.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.04_CN)
crs_s <- crs(banda_swir_23.04)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.04_CN <- project(Corno_Nero_23.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.04_CN <- project(Corno_Nero_23.04_CN, crs_p)
}
banda_swir_23.04_area <- crop(banda_swir_23.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.04_area <- crop(Corno_Nero_23.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.04 <- CN_CornoNero_23.04_area[[3]]
banda_vis_NDSI_23.04 <- terra::resample(banda_vis_NDSI_23.04, banda_swir_23.04_area, 
                                        method = "bilinear" )
banda_swir_23.04_area_m <- mask(banda_swir_23.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.04_m <- mask(banda_vis_NDSI_23.04, st_as_sf(AreaRitaglioCornoNero))
Q04_23 <- banda_vis_NDSI_23.04_m - banda_swir_23.04_area_m
B04_23 <- banda_vis_NDSI_23.04_m + banda_swir_23.04_area_m
NDSI_CornoNero_23.04_area <- Q04_23/B04_23
total_cells <- ncell(NDSI_CornoNero_23.04_area)
freq(NDSI_CornoNero_23.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.04_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.04)
contatore <- contatore +1
NDSI_CornoNero_23.04_area_df <- as.data.frame(NDSI_CornoNero_23.04_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.05
banda_swir_23.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.05.26 NDSI.tiff")
Corno_Nero_23.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.05_CN)
crs_s <- crs(banda_swir_23.05)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.05_CN <- project(Corno_Nero_23.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.05_CN <- project(Corno_Nero_23.05_CN, crs_p)
}
banda_swir_23.05_area <- crop(banda_swir_23.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.05_area <- crop(Corno_Nero_23.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.05 <- CN_CornoNero_23.05_area[[3]]
banda_vis_NDSI_23.05 <- terra::resample(banda_vis_NDSI_23.05, banda_swir_23.05_area, 
                                        method = "bilinear" )
banda_swir_23.05_area_m <- mask(banda_swir_23.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.05_m <- mask(banda_vis_NDSI_23.05, st_as_sf(AreaRitaglioCornoNero))
Q05_23 <- banda_vis_NDSI_23.05_m - banda_swir_23.05_area_m
B05_23 <- banda_vis_NDSI_23.05_m + banda_swir_23.05_area_m
NDSI_CornoNero_23.05_area <- Q05_23/B05_23
total_cells <- ncell(NDSI_CornoNero_23.05_area)
freq(NDSI_CornoNero_23.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.05_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.05)
contatore <- contatore +1
NDSI_CornoNero_23.05_area_df <- as.data.frame(NDSI_CornoNero_23.05_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.06
banda_swir_23.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.06.15 NDSI.tiff")
Corno_Nero_23.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.06_CN)
crs_s <- crs(banda_swir_23.06)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.06_CN <- project(Corno_Nero_23.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.06_CN <- project(Corno_Nero_23.06_CN, crs_p)
}
banda_swir_23.06_area <- crop(banda_swir_23.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.06_area <- crop(Corno_Nero_23.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.06 <- CN_CornoNero_23.06_area[[3]]
banda_vis_NDSI_23.06 <- terra::resample(banda_vis_NDSI_23.06, banda_swir_23.06_area, 
                                        method = "bilinear" )
banda_swir_23.06_area_m <- mask(banda_swir_23.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.06_m <- mask(banda_vis_NDSI_23.06, st_as_sf(AreaRitaglioCornoNero))
Q06_23 <- banda_vis_NDSI_23.06_m - banda_swir_23.06_area_m
B06_23 <- banda_vis_NDSI_23.06_m + banda_swir_23.06_area_m
NDSI_CornoNero_23.06_area <- Q06_23/B06_23
total_cells <- ncell(NDSI_CornoNero_23.06_area)
freq(NDSI_CornoNero_23.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.06_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.06)
contatore <- contatore +1
NDSI_CornoNero_23.06_area_df <- as.data.frame(NDSI_CornoNero_23.06_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2022_2023)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2022_2023 <- inverno2022_2023 +1
}

percentuali_righe

#----- FINE OTTAVO ANNO ------


#mese 22.09
banda_swir_22.09 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.09.13 NDSI.tiff")
Corno_Nero_22.09_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.09_CN)
crs_s <- crs(banda_swir_22.09)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.09_CN <- project(Corno_Nero_22.09_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.09_CN <- project(Corno_Nero_22.09_CN, crs_p)
}
banda_swir_22.09_area <- crop(banda_swir_22.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.09_area <- crop(Corno_Nero_22.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.09 <- CN_CornoNero_22.09_area[[3]]
banda_vis_NDSI_22.09 <- terra::resample(banda_vis_NDSI_22.09, banda_swir_22.09_area, 
                                        method = "bilinear" )
banda_swir_22.09_area_m <- mask(banda_swir_22.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.09_m <- mask(banda_vis_NDSI_22.09, st_as_sf(AreaRitaglioCornoNero))

Q09_22 <- banda_vis_NDSI_22.09_m - banda_swir_22.09_area_m
B09_22 <- banda_vis_NDSI_22.09_m + banda_swir_22.09_area_m
NDSI_CornoNero_22.09_area <- Q09_22/B09_22
total_cells <- ncell(NDSI_CornoNero_22.09_area)
freq(NDSI_CornoNero_22.09_area, value = NA)[1, "count"] #.......
cells_with_snow <- freq(NDSI_CornoNero_22.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.09)
contatore <- contatore +1
NDSI_CornoNero_22.09_area_df <- as.data.frame(NDSI_CornoNero_22.09_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.10
banda_swir_22.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.10.18 NDSI.tiff")
Corno_Nero_22.10_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.10_CN)
crs_s <- crs(banda_swir_22.10)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.10_CN <- project(Corno_Nero_22.10_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.10_CN <- project(Corno_Nero_22.10_CN, crs_p)
}
banda_swir_22.10_area <- crop(banda_swir_22.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.10_area <- crop(Corno_Nero_22.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.10 <- CN_CornoNero_22.10_area[[3]]
banda_vis_NDSI_22.10 <- terra::resample(banda_vis_NDSI_22.10, banda_swir_22.10_area, 
                                        method = "bilinear" )
banda_swir_22.10_area_m <- mask(banda_swir_22.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.10_m <- mask(banda_vis_NDSI_22.10, st_as_sf(AreaRitaglioCornoNero))

Q10_22 <- banda_vis_NDSI_22.10_m - banda_swir_22.10_area_m
B10_22 <- banda_vis_NDSI_22.10_m + banda_swir_22.10_area_m
NDSI_CornoNero_22.10_area <- Q10_22/B10_22

total_cells <- ncell(NDSI_CornoNero_22.10_area)
freq(NDSI_CornoNero_22.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.10)
contatore <- contatore +1
NDSI_CornoNero_22.10_area_df <- as.data.frame(NDSI_CornoNero_22.10_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()


#mese 22.11
banda_swir_22.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.11.19 NDSI.tiff")
Corno_Nero_22.11_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.11_CN)
crs_s <- crs(banda_swir_22.11)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.11_CN <- project(Corno_Nero_22.11_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.11_CN <- project(Corno_Nero_22.11_CN, crs_p)
}
banda_swir_22.11_area <- crop(banda_swir_22.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.11_area <- crop(Corno_Nero_22.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.11 <- CN_CornoNero_22.11_area[[3]]
banda_vis_NDSI_22.11 <- terra::resample(banda_vis_NDSI_22.11, banda_swir_22.11_area, 
                                        method = "bilinear" )
banda_swir_22.11_area_m <- mask(banda_swir_22.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.11_m <- mask(banda_vis_NDSI_22.11, st_as_sf(AreaRitaglioCornoNero))
Q11_22 <- banda_vis_NDSI_22.11_m - banda_swir_22.11_area_m
B11_22 <- banda_vis_NDSI_22.11_m + banda_swir_22.11_area_m
NDSI_CornoNero_22.11_area <- Q11_22/B11_22
total_cells <- ncell(NDSI_CornoNero_22.11_area)
freq(NDSI_CornoNero_22.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.11)
contatore <- contatore +1
NDSI_CornoNero_22.11_area_df <- as.data.frame(NDSI_CornoNero_22.11_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 22.12
banda_swir_22.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/22.12.07 NDSI.tiff")
Corno_Nero_22.12_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/22.08.21 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_22.12_CN)
crs_s <- crs(banda_swir_22.12)
if(!identical(crs_v, crs_s)){
  Corno_Nero_22.12_CN <- project(Corno_Nero_22.12_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_22.12_CN <- project(Corno_Nero_22.12_CN, crs_p)
}
banda_swir_22.12_area <- crop(banda_swir_22.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_22.12_area <- crop(Corno_Nero_22.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.12 <- CN_CornoNero_22.12_area[[3]]
banda_vis_NDSI_22.12 <- terra::resample(banda_vis_NDSI_22.12, banda_swir_22.12_area, 
                                        method = "bilinear" )
banda_swir_22.12_area_m <- mask(banda_swir_22.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_22.12_m <- mask(banda_vis_NDSI_22.12, st_as_sf(AreaRitaglioCornoNero))
Q12_22 <- banda_vis_NDSI_22.12_m - banda_swir_22.12_area_m
B12_22 <- banda_vis_NDSI_22.12_m + banda_swir_22.12_area_m
NDSI_CornoNero_22.12_area <- Q12_22/B12_22
total_cells <- ncell(NDSI_CornoNero_22.12_area)
freq(NDSI_CornoNero_22.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_22.12_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_22.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_22.12)
contatore <- contatore +1
NDSI_CornoNero_22.12_area_df <- as.data.frame(NDSI_CornoNero_22.12_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_22.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_22.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2022", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.01
banda_swir_23.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.01.21 NDSI.tiff")
Corno_Nero_23.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.01_CN)
crs_s <- crs(banda_swir_23.01)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.01_CN <- project(Corno_Nero_23.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.01_CN <- project(Corno_Nero_23.01_CN, crs_p)
}
banda_swir_23.01_area <- crop(banda_swir_23.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.01_area <- crop(Corno_Nero_23.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.01 <- CN_CornoNero_23.01_area[[3]]
banda_vis_NDSI_23.01 <- terra::resample(banda_vis_NDSI_23.01, banda_swir_23.01_area, 
                                        method = "bilinear" )
banda_swir_23.01_area_m <- mask(banda_swir_23.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.01_m <- mask(banda_vis_NDSI_23.01, st_as_sf(AreaRitaglioCornoNero))
Q01_23 <- banda_vis_NDSI_23.01_m - banda_swir_23.01_area_m
B01_23 <- banda_vis_NDSI_23.01_m + banda_swir_23.01_area_m
NDSI_CornoNero_23.01_area <- Q01_23/B01_23
total_cells <- ncell(NDSI_CornoNero_23.01_area)
freq(NDSI_CornoNero_23.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.01)
contatore <- contatore +1
NDSI_CornoNero_23.01_area_df <- as.data.frame(NDSI_CornoNero_23.01_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.02
banda_swir_23.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.02.07 NDSI.tiff")
Corno_Nero_23.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.02_CN)
crs_s <- crs(banda_swir_23.02)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.02_CN <- project(Corno_Nero_23.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.02_CN <- project(Corno_Nero_23.02_CN, crs_p)
}
banda_swir_23.02_area <- crop(banda_swir_23.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.02_area <- crop(Corno_Nero_23.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.02 <- CN_CornoNero_23.02_area[[3]]
banda_vis_NDSI_23.02 <- terra::resample(banda_vis_NDSI_23.02, banda_swir_23.02_area, 
                                        method = "bilinear" )
banda_swir_23.02_area_m <- mask(banda_swir_23.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.02_m <- mask(banda_vis_NDSI_23.02, st_as_sf(AreaRitaglioCornoNero))
Q02_23 <- banda_vis_NDSI_23.02_m - banda_swir_23.02_area_m
B02_23 <- banda_vis_NDSI_23.02_m + banda_swir_23.02_area_m
NDSI_CornoNero_23.02_area <- Q02_23/B02_23
total_cells <- ncell(NDSI_CornoNero_23.02_area)
freq(NDSI_CornoNero_23.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.02)
contatore <- contatore +1
NDSI_CornoNero_23.02_area_df <- as.data.frame(NDSI_CornoNero_23.02_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.03
banda_swir_23.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.03.25 NDSI.tiff")
Corno_Nero_23.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.03_CN)
crs_s <- crs(banda_swir_23.03)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.03_CN <- project(Corno_Nero_23.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.03_CN <- project(Corno_Nero_23.03_CN, crs_p)
}
banda_swir_23.03_area <- crop(banda_swir_23.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.03_area <- crop(Corno_Nero_23.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.03 <- CN_CornoNero_23.03_area[[3]]
banda_vis_NDSI_23.03 <- terra::resample(banda_vis_NDSI_23.03, banda_swir_23.03_area, 
                                        method = "bilinear" )
banda_swir_23.03_area_m <- mask(banda_swir_23.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.03_m <- mask(banda_vis_NDSI_23.03, st_as_sf(AreaRitaglioCornoNero))
Q03_23 <- banda_vis_NDSI_23.03_m - banda_swir_23.03_area_m
B03_23 <- banda_vis_NDSI_23.03_m + banda_swir_23.03_area_m
NDSI_CornoNero_23.03_area <- Q03_23/B03_23
total_cells <- ncell(NDSI_CornoNero_23.03_area)
freq(NDSI_CornoNero_23.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.03_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.03)
contatore <- contatore +1
NDSI_CornoNero_23.03_area_df <- as.data.frame(NDSI_CornoNero_23.03_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.04
banda_swir_23.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.04.03 NDSI.tiff")
Corno_Nero_23.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.04_CN)
crs_s <- crs(banda_swir_23.04)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.04_CN <- project(Corno_Nero_23.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.04_CN <- project(Corno_Nero_23.04_CN, crs_p)
}
banda_swir_23.04_area <- crop(banda_swir_23.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.04_area <- crop(Corno_Nero_23.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.04 <- CN_CornoNero_23.04_area[[3]]
banda_vis_NDSI_23.04 <- terra::resample(banda_vis_NDSI_23.04, banda_swir_23.04_area, 
                                        method = "bilinear" )
banda_swir_23.04_area_m <- mask(banda_swir_23.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.04_m <- mask(banda_vis_NDSI_23.04, st_as_sf(AreaRitaglioCornoNero))
Q04_23 <- banda_vis_NDSI_23.04_m - banda_swir_23.04_area_m
B04_23 <- banda_vis_NDSI_23.04_m + banda_swir_23.04_area_m
NDSI_CornoNero_23.04_area <- Q04_23/B04_23
total_cells <- ncell(NDSI_CornoNero_23.04_area)
freq(NDSI_CornoNero_23.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.04_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.04)
contatore <- contatore +1
NDSI_CornoNero_23.04_area_df <- as.data.frame(NDSI_CornoNero_23.04_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.05
banda_swir_23.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.05.26 NDSI.tiff")
Corno_Nero_23.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.05_CN)
crs_s <- crs(banda_swir_23.05)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.05_CN <- project(Corno_Nero_23.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.05_CN <- project(Corno_Nero_23.05_CN, crs_p)
}
banda_swir_23.05_area <- crop(banda_swir_23.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.05_area <- crop(Corno_Nero_23.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.05 <- CN_CornoNero_23.05_area[[3]]
banda_vis_NDSI_23.05 <- terra::resample(banda_vis_NDSI_23.05, banda_swir_23.05_area, 
                                        method = "bilinear" )
banda_swir_23.05_area_m <- mask(banda_swir_23.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.05_m <- mask(banda_vis_NDSI_23.05, st_as_sf(AreaRitaglioCornoNero))
Q05_23 <- banda_vis_NDSI_23.05_m - banda_swir_23.05_area_m
B05_23 <- banda_vis_NDSI_23.05_m + banda_swir_23.05_area_m
NDSI_CornoNero_23.05_area <- Q05_23/B05_23
total_cells <- ncell(NDSI_CornoNero_23.05_area)
freq(NDSI_CornoNero_23.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.05_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.05)
contatore <- contatore +1
NDSI_CornoNero_23.05_area_df <- as.data.frame(NDSI_CornoNero_23.05_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.06
banda_swir_23.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.06.15 NDSI.tiff")
Corno_Nero_23.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.06_CN)
crs_s <- crs(banda_swir_23.06)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.06_CN <- project(Corno_Nero_23.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.06_CN <- project(Corno_Nero_23.06_CN, crs_p)
}
banda_swir_23.06_area <- crop(banda_swir_23.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.06_area <- crop(Corno_Nero_23.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.06 <- CN_CornoNero_23.06_area[[3]]
banda_vis_NDSI_23.06 <- terra::resample(banda_vis_NDSI_23.06, banda_swir_23.06_area, 
                                        method = "bilinear" )
banda_swir_23.06_area_m <- mask(banda_swir_23.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.06_m <- mask(banda_vis_NDSI_23.06, st_as_sf(AreaRitaglioCornoNero))
Q06_23 <- banda_vis_NDSI_23.06_m - banda_swir_23.06_area_m
B06_23 <- banda_vis_NDSI_23.06_m + banda_swir_23.06_area_m
NDSI_CornoNero_23.06_area <- Q06_23/B06_23
total_cells <- ncell(NDSI_CornoNero_23.06_area)
freq(NDSI_CornoNero_23.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.06_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.06)
contatore <- contatore +1
NDSI_CornoNero_23.06_area_df <- as.data.frame(NDSI_CornoNero_23.06_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2022_2023)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2022_2023 <- inverno2022_2023 +1
}

percentuali_righe

#----- FINE SETTIMO ANNO ------


#mese 23.09
banda_swir_23.09 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.09.25 NDSI.tiff")
Corno_Nero_23.09_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.09_CN)
crs_s <- crs(banda_swir_23.09)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.09_CN <- project(Corno_Nero_23.09_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.09_CN <- project(Corno_Nero_23.09_CN, crs_p)
}
banda_swir_23.09_area <- crop(banda_swir_23.09, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.09_area <- crop(Corno_Nero_23.09_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.09 <- CN_CornoNero_23.09_area[[3]]
banda_vis_NDSI_23.09 <- terra::resample(banda_vis_NDSI_23.09, banda_swir_23.09_area, 
                                        method = "bilinear" )
banda_swir_23.09_area_m <- mask(banda_swir_23.09_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.09_m <- mask(banda_vis_NDSI_23.09, st_as_sf(AreaRitaglioCornoNero))

Q09_23 <- banda_vis_NDSI_23.09_m - banda_swir_23.09_area_m
B09_23 <- banda_vis_NDSI_23.09_m + banda_swir_23.09_area_m
NDSI_CornoNero_23.09_area <- Q09_23/B09_23
total_cells <- ncell(NDSI_CornoNero_23.09_area)
freq(NDSI_CornoNero_23.09_area, value = NA)[1, "count"] #.......
cells_with_snow <- freq(NDSI_CornoNero_23.09_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.09 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.09)
contatore <- contatore +1
NDSI_CornoNero_23.09_area_df <- as.data.frame(NDSI_CornoNero_23.09_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.09_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.09_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Settembre 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.10
banda_swir_23.10 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.10.13 NDSI.tiff")
Corno_Nero_23.10_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.10_CN)
crs_s <- crs(banda_swir_23.10)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.10_CN <- project(Corno_Nero_23.10_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.10_CN <- project(Corno_Nero_23.10_CN, crs_p)
}
banda_swir_23.10_area <- crop(banda_swir_23.10, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.10_area <- crop(Corno_Nero_23.10_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.10 <- CN_CornoNero_23.10_area[[3]]
banda_vis_NDSI_23.10 <- terra::resample(banda_vis_NDSI_23.10, banda_swir_23.10_area, 
                                        method = "bilinear" )
banda_swir_23.10_area_m <- mask(banda_swir_23.10_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.10_m <- mask(banda_vis_NDSI_23.10, st_as_sf(AreaRitaglioCornoNero))

Q10_23 <- banda_vis_NDSI_23.10_m - banda_swir_23.10_area_m
B10_23 <- banda_vis_NDSI_23.10_m + banda_swir_23.10_area_m
NDSI_CornoNero_23.10_area <- Q10_23/B10_23

total_cells <- ncell(NDSI_CornoNero_23.10_area)
freq(NDSI_CornoNero_23.10_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.10_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.10 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.10)
contatore <- contatore +1
NDSI_CornoNero_23.10_area_df <- as.data.frame(NDSI_CornoNero_23.10_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.10_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.10_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Ottobre 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()


#mese 23.11
banda_swir_23.11 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.11.14 NDSI.tiff")
Corno_Nero_23.11_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.11_CN)
crs_s <- crs(banda_swir_23.11)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.11_CN <- project(Corno_Nero_23.11_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.11_CN <- project(Corno_Nero_23.11_CN, crs_p)
}
banda_swir_23.11_area <- crop(banda_swir_23.11, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.11_area <- crop(Corno_Nero_23.11_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.11 <- CN_CornoNero_23.11_area[[3]]
banda_vis_NDSI_23.11 <- terra::resample(banda_vis_NDSI_23.11, banda_swir_23.11_area, 
                                        method = "bilinear" )
banda_swir_23.11_area_m <- mask(banda_swir_23.11_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.11_m <- mask(banda_vis_NDSI_23.11, st_as_sf(AreaRitaglioCornoNero))
Q11_23 <- banda_vis_NDSI_23.11_m - banda_swir_23.11_area_m
B11_23 <- banda_vis_NDSI_23.11_m + banda_swir_23.11_area_m
NDSI_CornoNero_23.11_area <- Q11_23/B11_23
total_cells <- ncell(NDSI_CornoNero_23.11_area)
freq(NDSI_CornoNero_23.11_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.11_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.11 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.11)
contatore <- contatore +1
NDSI_CornoNero_23.11_area_df <- as.data.frame(NDSI_CornoNero_23.11_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.11_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.11_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Novembre 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.12
banda_swir_23.12 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/23.12.19 NDSI.tiff")
Corno_Nero_23.12_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/23.08.11 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_23.12_CN)
crs_s <- crs(banda_swir_23.12)
if(!identical(crs_v, crs_s)){
  Corno_Nero_23.12_CN <- project(Corno_Nero_23.12_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_23.12_CN <- project(Corno_Nero_23.12_CN, crs_p)
}
banda_swir_23.12_area <- crop(banda_swir_23.12, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_23.12_area <- crop(Corno_Nero_23.12_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.12 <- CN_CornoNero_23.12_area[[3]]
banda_vis_NDSI_23.12 <- terra::resample(banda_vis_NDSI_23.12, banda_swir_23.12_area, 
                                        method = "bilinear" )
banda_swir_23.12_area_m <- mask(banda_swir_23.12_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_23.12_m <- mask(banda_vis_NDSI_23.12, st_as_sf(AreaRitaglioCornoNero))
Q12_23 <- banda_vis_NDSI_23.12_m - banda_swir_23.12_area_m
B12_23 <- banda_vis_NDSI_23.12_m + banda_swir_23.12_area_m
NDSI_CornoNero_23.12_area <- Q12_23/B12_23
total_cells <- ncell(NDSI_CornoNero_23.12_area)
freq(NDSI_CornoNero_23.12_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_23.12_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_23.12 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_23.12)
contatore <- contatore +1
NDSI_CornoNero_23.12_area_df <- as.data.frame(NDSI_CornoNero_23.12_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_23.12_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_23.12_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Dicembre 2023", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 24.01
banda_swir_24.01 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/24.01.16 NDSI.tiff")
Corno_Nero_24.01_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/24.07.31 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_24.01_CN)
crs_s <- crs(banda_swir_24.01)
if(!identical(crs_v, crs_s)){
  Corno_Nero_24.01_CN <- project(Corno_Nero_24.01_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_24.01_CN <- project(Corno_Nero_24.01_CN, crs_p)
}
banda_swir_24.01_area <- crop(banda_swir_24.01, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_24.01_area <- crop(Corno_Nero_24.01_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.01 <- CN_CornoNero_24.01_area[[3]]
banda_vis_NDSI_24.01 <- terra::resample(banda_vis_NDSI_24.01, banda_swir_24.01_area, 
                                        method = "bilinear" )
banda_swir_24.01_area_m <- mask(banda_swir_24.01_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.01_m <- mask(banda_vis_NDSI_24.01, st_as_sf(AreaRitaglioCornoNero))
Q01_24 <- banda_vis_NDSI_24.01_m - banda_swir_24.01_area_m
B01_24 <- banda_vis_NDSI_24.01_m + banda_swir_24.01_area_m
NDSI_CornoNero_24.01_area <- Q01_24/B01_24
total_cells <- ncell(NDSI_CornoNero_24.01_area)
freq(NDSI_CornoNero_24.01_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_24.01_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_24.01 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_24.01)
contatore <- contatore +1
NDSI_CornoNero_24.01_area_df <- as.data.frame(NDSI_CornoNero_24.01_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_24.01_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_24.01_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Gennaio 2024", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 24.02
banda_swir_24.02 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/24.02.15 NDSI.tiff")
Corno_Nero_24.02_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/24.07.31 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_24.02_CN)
crs_s <- crs(banda_swir_24.02)
if(!identical(crs_v, crs_s)){
  Corno_Nero_24.02_CN <- project(Corno_Nero_24.02_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_24.02_CN <- project(Corno_Nero_24.02_CN, crs_p)
}
banda_swir_24.02_area <- crop(banda_swir_24.02, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_24.02_area <- crop(Corno_Nero_24.02_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.02 <- CN_CornoNero_24.02_area[[3]]
banda_vis_NDSI_24.02 <- terra::resample(banda_vis_NDSI_24.02, banda_swir_24.02_area, 
                                        method = "bilinear" )
banda_swir_24.02_area_m <- mask(banda_swir_24.02_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.02_m <- mask(banda_vis_NDSI_24.02, st_as_sf(AreaRitaglioCornoNero))
Q02_24 <- banda_vis_NDSI_24.02_m - banda_swir_24.02_area_m
B02_24 <- banda_vis_NDSI_24.02_m + banda_swir_24.02_area_m
NDSI_CornoNero_24.02_area <- Q02_24/B02_24
total_cells <- ncell(NDSI_CornoNero_24.02_area)
freq(NDSI_CornoNero_24.02_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_24.02_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_24.02 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_24.02)
contatore <- contatore +1
NDSI_CornoNero_24.02_area_df <- as.data.frame(NDSI_CornoNero_24.02_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_24.02_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_24.02_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Febbraio 2024", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 23.03
banda_swir_24.03 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/24.03.13 NDSI.tiff")
Corno_Nero_24.03_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/24.07.31 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_24.03_CN)
crs_s <- crs(banda_swir_24.03)
if(!identical(crs_v, crs_s)){
  Corno_Nero_24.03_CN <- project(Corno_Nero_24.03_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_24.03_CN <- project(Corno_Nero_24.03_CN, crs_p)
}
banda_swir_24.03_area <- crop(banda_swir_24.03, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_24.03_area <- crop(Corno_Nero_24.03_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.03 <- CN_CornoNero_24.03_area[[3]]
banda_vis_NDSI_24.03 <- terra::resample(banda_vis_NDSI_24.03, banda_swir_24.03_area, 
                                        method = "bilinear" )
banda_swir_24.03_area_m <- mask(banda_swir_24.03_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.03_m <- mask(banda_vis_NDSI_24.03, st_as_sf(AreaRitaglioCornoNero))
Q03_24 <- banda_vis_NDSI_24.03_m - banda_swir_24.03_area_m
B03_24 <- banda_vis_NDSI_24.03_m + banda_swir_24.03_area_m
NDSI_CornoNero_24.03_area <- Q03_24/B03_24
total_cells <- ncell(NDSI_CornoNero_24.03_area)
freq(NDSI_CornoNero_24.03_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_24.03_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_24.03 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_24.03)
contatore <- contatore +1
NDSI_CornoNero_24.03_area_df <- as.data.frame(NDSI_CornoNero_24.03_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_24.03_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_24.03_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Marzo 2024", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 24.04
banda_swir_24.04 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/24.04.12 NDSI.tiff")
Corno_Nero_24.04_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/24.07.31 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_24.04_CN)
crs_s <- crs(banda_swir_24.04)
if(!identical(crs_v, crs_s)){
  Corno_Nero_24.04_CN <- project(Corno_Nero_24.04_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_24.04_CN <- project(Corno_Nero_24.04_CN, crs_p)
}
banda_swir_24.04_area <- crop(banda_swir_24.04, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_24.04_area <- crop(Corno_Nero_24.04_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.04 <- CN_CornoNero_24.04_area[[3]]
banda_vis_NDSI_24.04 <- terra::resample(banda_vis_NDSI_24.04, banda_swir_24.04_area, 
                                        method = "bilinear" )
banda_swir_24.04_area_m <- mask(banda_swir_24.04_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.04_m <- mask(banda_vis_NDSI_24.04, st_as_sf(AreaRitaglioCornoNero))
Q04_24 <- banda_vis_NDSI_24.04_m - banda_swir_24.04_area_m
B04_24 <- banda_vis_NDSI_24.04_m + banda_swir_24.04_area_m
NDSI_CornoNero_24.04_area <- Q04_24/B04_24
total_cells <- ncell(NDSI_CornoNero_24.04_area)
freq(NDSI_CornoNero_24.04_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_24.04_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_24.04 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_24.04)
contatore <- contatore +1
NDSI_CornoNero_24.04_area_df <- as.data.frame(NDSI_CornoNero_24.04_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_24.04_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_24.04_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Aprile 2024", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 24.05
banda_swir_24.05 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/24.05.05 NDSI.tiff")
Corno_Nero_24.05_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/24.07.31 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_24.05_CN)
crs_s <- crs(banda_swir_24.05)
if(!identical(crs_v, crs_s)){
  Corno_Nero_24.05_CN <- project(Corno_Nero_24.05_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_24.05_CN <- project(Corno_Nero_24.05_CN, crs_p)
}
banda_swir_24.05_area <- crop(banda_swir_24.05, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_24.05_area <- crop(Corno_Nero_24.05_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.05 <- CN_CornoNero_24.05_area[[3]]
banda_vis_NDSI_24.05 <- terra::resample(banda_vis_NDSI_24.05, banda_swir_24.05_area, 
                                        method = "bilinear" )
banda_swir_24.05_area_m <- mask(banda_swir_24.05_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.05_m <- mask(banda_vis_NDSI_24.05, st_as_sf(AreaRitaglioCornoNero))
Q05_24 <- banda_vis_NDSI_24.05_m - banda_swir_24.05_area_m
B05_24 <- banda_vis_NDSI_24.05_m + banda_swir_24.05_area_m
NDSI_CornoNero_24.05_area <- Q05_24/B05_24
total_cells <- ncell(NDSI_CornoNero_24.05_area)
freq(NDSI_CornoNero_24.05_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_24.05_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_24.05 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_24.05)
contatore <- contatore +1
NDSI_CornoNero_24.05_area_df <- as.data.frame(NDSI_CornoNero_24.05_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_24.05_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_24.05_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Maggio 2024", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

#mese 24.06
banda_swir_24.06 <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/NDSI/24.06.19 NDSI.tiff")
Corno_Nero_24.06_CN <- rast(
  "C:/Users/Proprietario/Desktop/fmach/immagini_copernicus_CornoNero/CN/24.07.31 ColoriN_CornoNero.tiff")
crs_v <- crs(Corno_Nero_24.06_CN)
crs_s <- crs(banda_swir_24.06)
if(!identical(crs_v, crs_s)){
  Corno_Nero_24.06_CN <- project(Corno_Nero_24.06_CN, crs_s)
}
crs_p <- crs(AreaRitaglioCornoNero)
crs_p
if(!identical(crs_v, crs_p)){
  Corno_Nero_24.06_CN <- project(Corno_Nero_24.06_CN, crs_p)
}
banda_swir_24.06_area <- crop(banda_swir_24.06, st_as_sf(AreaRitaglioCornoNero))
CN_CornoNero_24.06_area <- crop(Corno_Nero_24.06_CN, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.06 <- CN_CornoNero_24.06_area[[3]]
banda_vis_NDSI_24.06 <- terra::resample(banda_vis_NDSI_24.06, banda_swir_24.06_area, 
                                        method = "bilinear" )
banda_swir_24.06_area_m <- mask(banda_swir_24.06_area, st_as_sf(AreaRitaglioCornoNero))
banda_vis_NDSI_24.06_m <- mask(banda_vis_NDSI_24.06, st_as_sf(AreaRitaglioCornoNero))
Q06_24 <- banda_vis_NDSI_24.06_m - banda_swir_24.06_area_m
B06_24 <- banda_vis_NDSI_24.06_m + banda_swir_24.06_area_m
NDSI_CornoNero_24.06_area <- Q06_24/B06_24
total_cells <- ncell(NDSI_CornoNero_24.06_area)
freq(NDSI_CornoNero_24.06_area, value = NA)[1, "count"]
cells_with_snow <- freq(NDSI_CornoNero_24.06_area > 0.5, value = TRUE)[1, "count"]
percentage_snow_24.06 <- (cells_with_snow / total_cells) * 100
riga_corrente <- c(riga_corrente, percentage_snow_24.06)
contatore <- contatore +1
NDSI_CornoNero_24.06_area_df <- as.data.frame(NDSI_CornoNero_24.06_area, 
                                              xy = TRUE, na.rm = TRUE)
colnames(NDSI_CornoNero_24.06_area_df) <- c("x", "y", "NDSI")
ggplot(NDSI_CornoNero_24.06_area_df, aes(x = x, y = y, fill = NDSI)) +
  geom_raster() +
  scale_fill_gradient2(low = "darkgreen", mid = "white", high = "darkblue", midpoint = 0) +
  labs(title = "Indice NDSI Giugno 2024", x = "Longitudine", y = "Latitudine", fill = "NDSI") +
  theme_minimal()

if(contatore == valori_per_riga)
{percentuali_righe <- append (percentuali_righe,
                              list(riga_corrente))
riga_corrente <- c()
contatore <- 0
}

if(contatore==valori_per_riga)
{percentuali_righe[[paste0("Riga_", inverno2023_2024)]] <- riga_corrente
riga_corrente<- c()
contatore <- 0
inverno2023_2024 <- inverno2023_2024 +1
}

percentuali_righe

#ho creato il mio data frame di percentuali

df_percentuali <- do.call(rbind, percentuali_righe)
colnames(df_percentuali) <- c ("Settebre", "Ottobre", "Novembre", "Dicembre", "Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno")
rownames(df_percentuali) <- c ("ndsi2015_2016", "ndsi2016_2017", "ndsi2017_2018", "ndsi2018_2019", "ndsi2019_2020", "ndsi2020_2021", "ndsi2021_2022", "ndsi2022_2023", "ndsi2023_2024")
df_percentuali

#____________________RICOSTRUZIONE GRAFICA DEL DF__________________________

df_p_gg <- df_percentuali%>%
  as.data.frame() %>%
  mutate(Riga = rownames(df_percentuali)) %>%
  pivot_longer(cols = -Riga, names_to = "Mese", values_to = "Valore")

ordine_mesi <- c("Settebre", "Ottobre", "Novembre", "Dicembre", "Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno")
df_p_gg

df_p_gg$Mese <- factor(df_p_gg$Mese, levels = ordine_mesi)

ggplot(df_p_gg, aes(x = Mese, y = Valore, color = Riga, group = Riga))+
  geom_line(size = 1)+
  geom_point(size = 2)+
  scale_color_manual(values = c("ndsi2015_2016" = "blue",
                                "ndsi2016_2017" = "green",
                                "ndsi2017_2018" = "yellow",
                                "ndsi2018_2019" = "red",
                                "ndsi2019_2020" = "pink",
                                "ndsi2020_2021" = "purple",
                                "ndsi2021_2022" = "black",
                                "ndsi2022_2023" = "orange",
                                "ndsi2023_2024" = "brown"))+
  labs(title = "Andamento percentuale copertura di neve aree Corno Nero",
       subtitle = "Valori registrati per ogni mese",
       x = "Mese",
       y = "Valore in percentuale",
       color = "anno")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ Riga, scales = "free_y")
